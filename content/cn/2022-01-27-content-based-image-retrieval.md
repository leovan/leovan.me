---
title: åŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢ (Content Based Image Retrieval, CBIR)
author: èŒƒå¶äº®
date: '2022-01-27'
slug: content-based-image-retrieval
show_toc: true
toc_depth: 3
categories:
  - æœºå™¨å­¦ä¹ 
  - æ·±åº¦å­¦ä¹ 
  - è¡¨ç¤ºå­¦ä¹ 
tags:
  - å›¾åƒ
  - æ£€ç´¢
  - å›¾åƒæ£€ç´¢
  - Image Retrieval
  - å®ä¾‹æ£€ç´¢
  - Instance Retrieval
  - åŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢
  - CBIR
  - Content Based Image Retrieval
  - SIFT
  - Scale-invariant Feature Transform
  - è§†è§‰è¯æ±‡
  - Visual Word
  - Harris è§’ç‚¹æ£€æµ‹
  - å°ºåº¦ç©ºé—´
  - é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯ç®—å­
  - Laplacian of Gaussian
  - LoG
  - é«˜æ–¯å·®åˆ†ç®—å­
  - Difference of Gaussian
  - DoG
  - é«˜æ–¯é‡‘å­—å¡”
  - Octave
  - Interval
  - å­åƒç´ æ’å€¼
  - Sub-pixel Interpolation
  - æ¢¯åº¦å¹…å€¼
  - BoF
  - Bag of Features
  - Bag of Visual Words
  - è§†è§‰è¯å…¸
  - VLAD
  - Vector of Local Aggregated Descriptors
  - Fisher å‘é‡
  - FV
  - Fisher Vector
  - é«˜æ–¯æ··åˆæ¨¡å‹
  - GMM
  - Gaussian Mixture Model
  - ç©ºé—´é‡‘å­—å¡”æ¨¡å‹
  - Spatial Pyramid Models
  - åŒºåŸŸå€™é€‰ç½‘ç»œ
  - Region Proposal Networks
  - RPN
  - RANSAC
  - MAC
  - R-MAC
  - GeM polling
  - SPoC
  - CroW
  - CAM+CroW
  - intra-model
  - inter-model
  - early fusion
  - late fusion
images:
  - /images/cn/2022-01-27-content-based-image-retrieval/cbir-history.png
  - /images/cn/2022-01-27-content-based-image-retrieval/sift-and-dl-based-cbir-pipeline.png
  - /images/cn/2022-01-27-content-based-image-retrieval/dl-based-cbir-pipeline.png
---

> æœ¬æ–‡ä¸»è¦å‚è€ƒè‡ª _SIFT meets CNN: A decade survey of instance retrieval_ [^zheng2017sift] å’Œ _Deep Learning for Instance Retrieval: A Survey_ [^chen2022deep]ã€‚

**åŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢ï¼ˆContent-based image retrievalï¼ŒCBIRï¼‰**ï¼Œå±äºå›¾åƒåˆ†æçš„ä¸€ä¸ªç ”ç©¶é¢†åŸŸã€‚åŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢ç›®çš„æ˜¯åœ¨ç»™å®šæŸ¥è¯¢å›¾åƒçš„å‰æä¸‹ï¼Œä¾æ®å†…å®¹ä¿¡æ¯æˆ–æŒ‡å®šæŸ¥è¯¢æ ‡å‡†ï¼Œåœ¨å›¾åƒæ•°æ®åº“ä¸­æœç´¢å¹¶æŸ¥æ‰¾å‡ºç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„ç›¸åº”å›¾ç‰‡ [^cbir-wikipedia]ã€‚

æ ¹æ®ä¸åŒçš„è§†è§‰è¡¨ç¤ºæ–¹æ³•ï¼Œå¯ä»¥å°†åŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢æ–¹æ³•åˆ†ä¸ºä¸¤ç±»ï¼š**åŸºäº SIFT ç‰¹å¾çš„**å’Œ**åŸºäºæ·±åº¦å­¦ä¹ çš„**ã€‚åŸºäº SIFT ç‰¹å¾çš„æ–¹æ³•åˆ†ä¸ºå¦‚ä¸‹ 3 ç±»ï¼š

1. **ä½¿ç”¨å°å‹ç¼–ç æœ¬**ï¼šè§†è§‰è¯æ±‡å°‘äºå‡ åƒä¸ªï¼Œç´§å‡‘å‘é‡åœ¨é™ç»´å’Œç¼–ç ä¹‹å‰ç”Ÿæˆã€‚
2. **ä½¿ç”¨ä¸­å‹ç¼–ç æœ¬**ï¼šè€ƒè™‘åˆ° BoW çš„ç¨€ç–æ€§å’Œè§†è§‰è¯æ±‡çš„ä½åŒºåˆ†åº¦ï¼Œä½¿ç”¨å€’æ’ç´¢å¼•å’ŒäºŒè¿›åˆ¶ç­¾åæ–¹æ³•ã€‚å‡†ç¡®ç‡å’Œæ•ˆç‡ä¹‹é—´çš„æƒè¡¡æ˜¯è¯¥ç®—æ³•çš„ä¸»è¦å½±å“å› ç´ ã€‚
3. **ä½¿ç”¨å¤§å‹ç¼–ç æœ¬**ï¼šè€ƒè™‘åˆ° BoW ç›´æ–¹å›¾çš„ç¨€ç–æ€§å’Œè§†è§‰è¯æ±‡çš„é«˜åŒºåˆ†åº¦ï¼Œåœ¨ç®—æ³•ä¸­ä½¿ç”¨äº†å€’æ’ç´¢å¼•å’Œå­˜å‚¨å‹å¥½å‹çš„ç­¾åæ–¹å¼ã€‚åœ¨ç¼–ç æœ¬ç”Ÿæˆå’Œç¼–ç ä¸­ä½¿ç”¨äº†ç±»ä¼¼çš„æ–¹æ³•ã€‚

åŸºäºæ·±åº¦å­¦ä¹ çš„æ–¹æ³•åˆ†ä¸ºå¦‚ä¸‹ 3 ç±»ï¼š

1. **æ··åˆå‹æ–¹æ³•**ï¼šå›¾åƒå—è¢«å¤šæ¬¡è¾“å…¥åˆ° CNN ä¸­ç”¨äºç‰¹å¾æå–ã€‚ç¼–ç ä¸ç´¢å¼•æ–¹æ³•å’ŒåŸºäº SIFT çš„æ£€ç´¢æ–¹æ³•ç±»ä¼¼ã€‚
2. **ä½¿ç”¨é¢„è®­ç»ƒçš„æ¨¡å‹**ï¼šé€šè¿‡åœ¨ç±»ä¼¼ ImageNet çš„å¤§æ•°æ®é›†é¢„è®­ç»ƒçš„ CNN æ¨¡å‹è¿›è¡Œå•é€šé“ç‰¹å¾æå–ï¼ŒåŒæ—¶ä½¿ç”¨ç´§å‡‘ç¼–ç å’Œæ± åŒ–æŠ€æœ¯ã€‚
3. **ä½¿ç”¨å¾®è°ƒçš„æ¨¡å‹**ï¼šåœ¨å›¾åƒä¸ç›®æ ‡æ•°æ®å…·æœ‰ç›¸ä¼¼åˆ†å¸ƒçš„è®­ç»ƒé›†ä¸Šå¯¹ CNN æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚é€šè¿‡ç«¯åˆ°ç«¯çš„æ–¹æ³•åˆ©ç”¨ CNN æ¨¡å‹è¿›è¡Œå•é€šé“ç‰¹å¾æå–ã€‚è¿™ç§è§†è§‰è¡¨ç¤ºæ–¹æ³•å¯ä»¥æå‡æ¨¡å‹çš„åŒºåˆ†èƒ½åŠ›ã€‚

å„ç±»æ¨¡å‹çš„å¼‚åŒç‚¹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

<table>
<thead>
  <tr>
    <th colspan="2">æ–¹æ³•ç±»å‹</th>
    <th>æ£€æµ‹</th>
    <th>æè¿°</th>
    <th>ç¼–ç </th>
    <th>ç»´åº¦</th>
    <th>ç´¢å¼•</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td rowspan="3">åŸºäº SIFT</td>
    <td>å¤§ç¼–ç æœ¬</td>
    <td rowspan="3">DoG,<br>Hessian-Affine,<br>dense patches ç­‰</td>
    <td rowspan="3">å±€éƒ¨ä¸å˜<br>æè¿°ï¼Œä¾‹å¦‚ï¼š<br>SIFT</td>
    <td>Hard, soft</td>
    <td>é«˜</td>
    <td>å€’æ’ç´¢å¼•</td>
  </tr>
  <tr>
    <td>ä¸­ç¼–ç æœ¬</td>
    <td>Hard, soft, HE</td>
    <td>ä¸­</td>
    <td>å€’æ’ç´¢å¼•</td>
  </tr>
  <tr>
    <td>å°ç¼–ç æœ¬</td>
    <td>VLAD, FV</td>
    <td>ä½</td>
    <td>ANN æ¨¡å‹</td>
  </tr>
  <tr>
    <td rowspan="3">åŸºäºæ·±åº¦å­¦ä¹ </td>
    <td>æ··åˆæ¨¡å‹</td>
    <td>å›¾åƒå—</td>
    <td>CNN ç‰¹å¾</td>
    <td>VLAD, FV, pooling</td>
    <td>ä¸å®š</td>
    <td>ANN æ¨¡å‹</td>
  </tr>
  <tr>
    <td>é¢„è®­ç»ƒæ¨¡å‹</td>
    <td colspan="2">é¢„è®­ç»ƒ CNN æ¨¡å‹çš„åˆ—ç‰¹å¾æˆ–å…¨è¿æ¥å±‚</td>
    <td>VLAD, FV, pooling</td>
    <td>ä½</td>
    <td>ANN æ¨¡å‹</td>
  </tr>
  <tr>
    <td>å¾®è°ƒæ¨¡å‹</td>
    <td colspan="3">ä»é¢„è®­ç»ƒ CNN æ¨¡å‹ä¸­ç«¯åˆ°ç«¯æå–çš„å…¨å±€ç‰¹å¾</td>
    <td>ä½</td>
    <td>ANN æ¨¡å‹</td>
  </tr>
</tbody>
</table>

åŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢é‡Œç¨‹ç¢‘èŠ‚ç‚¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/cbir-history.png)

## åŸºäº SIFT çš„å›¾åƒæ£€ç´¢

åŸºäº SIFT çš„å›¾åƒæ£€ç´¢æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/sift-and-dl-based-cbir-pipeline.png)

1. **å±€éƒ¨ç‰¹å¾æå–**ï¼šå‡è®¾æœ‰ä¸€ä¸ªåŒ…å« `$N$` å¼ å›¾ç‰‡çš„é›†åˆ `$\mathcal{G}$`ã€‚æŒ‡å®šä¸€ä¸ªç‰¹å¾æ£€æµ‹å™¨ï¼Œä»ç¨€ç–çš„å…´è¶£ç‚¹æˆ–å¯†é›†çš„å›¾åƒå—ä¸­æå–å±€éƒ¨æè¿°ç¬¦ã€‚æˆ‘ä»¬ç”¨ `$D$` è¡¨ç¤ºå±€éƒ¨æè¿°ç¬¦ï¼Œ`$\left\{f_{i}\right\}_{i=i}^{D}, f_{i} \in \mathbb{R}^{p}$` è¡¨ç¤ºå›¾åƒä¸­è¢«æ£€æµ‹çš„åŒºåŸŸã€‚
2. **ç¼–ç æœ¬è®­ç»ƒ**ï¼šåŸºäº SIFT çš„æ–¹æ³•éœ€è¦ç¦»çº¿è®­ç»ƒä¸€ä¸ªç¼–ç æœ¬ã€‚ç¼–ç æœ¬ä¸­çš„æ¯ä¸ªè§†è§‰è¯æ±‡ä½äºå­ç©ºé—´çš„ä¸­å¿ƒï¼Œç§°ä¸º Voronoi Cellã€‚ä¸€ä¸ªæ›´å¤§çš„å¯†ç æœ¬å¯¹åº”ä¸€ä¸ªæ›´ç²¾ç»†çš„åˆ’åˆ†ï¼Œè¿›è€Œäº§ç”Ÿæ›´æœ‰åŒºåˆ†æ€§çš„è§†è§‰è¯æ±‡ï¼Œåä¹‹äº¦ç„¶ã€‚å‡è®¾å­˜åœ¨ä¸€ä¸ªç”¨æ— æ ‡æ³¨æ•°æ®é›†è®­ç»ƒçš„å±€éƒ¨æè¿°ç¬¦æ±  `$\mathcal{F} \equiv\left\{f_{i}\right\}_{i=1}^{M}$`ï¼Œä¸€ä¸ªåŸºå‡†æ–¹æ³•æ˜¯åˆ©ç”¨ K-means å°† `$M$` ä¸ªç‚¹èšç±»æˆ `$K$` ä¸ªç°‡ï¼Œè¿™ `$K$` ä¸ªè§†è§‰è¯æ±‡åˆ™æ„æˆäº†å¤§å°ä¸º `$K$` çš„ç¼–ç æœ¬ã€‚
3. **ç‰¹å¾ç¼–ç **ï¼šä¸€ä¸ªå±€éƒ¨æè¿°ç¬¦ `$f_{i} \in \mathbb{R}^{p}$` é€šè¿‡ç‰¹å¾ç¼–ç è¿‡ç¨‹ `$f_{i} \rightarrow g_{i}$` è¢«æ˜ å°„åˆ°åµŒå…¥ç‰¹å¾ `$g_{i} \in \mathbb{R}^{l}$`ã€‚å½“ä½¿ç”¨ K-means èšç±»æ—¶ï¼Œ`$f_i$` å¯ä»¥æ ¹æ®å…¶ä¸è§†è§‰è¯æ±‡çš„è·ç¦»è¿›è¡Œç¼–ç ã€‚

### å±€éƒ¨ç‰¹å¾æå–

#### Harris è§’ç‚¹æ£€æµ‹

ç‰¹å¾ç‚¹åœ¨å›¾åƒä¸­ä¸€èˆ¬æœ‰å…·ä½“çš„åæ ‡ï¼Œå¹¶å…·æœ‰æŸäº›æ•°å­¦ç‰¹å¾ï¼Œå¦‚å±€éƒ¨æœ€å¤§æˆ–æœ€å°ç°åº¦ã€ä»¥åŠæŸäº›æ¢¯åº¦ç‰¹å¾ç­‰ã€‚å¯ä»¥é€šè¿‡åŠ æƒçš„å·®å€¼å¹³æ–¹å’Œæ¥å½¢å¼åŒ–çš„æ¯”è¾ƒä¸€ä¸ªå›¾åƒçš„ä¸¤ä¸ªåŒºå—ï¼š

`$$
\label{eq:e_u_v}
E\left(u, v\right) = \sum_{x, y} w\left(x, y\right)\left[I\left(x + u, y + v\right)-I\left(x, y\right)\right]^{2}
$$`

å…¶ä¸­ï¼Œ`$I$` ä¸ºå¾…æ¯”è¾ƒçš„å›¾åƒï¼Œ`$\left(u, v\right)$` ä¸ºå¹³ç§»å‘é‡ï¼Œ`$w\left(x, y\right)$` æ˜¯åœ¨ç©ºé—´ä¸Šå˜åŒ–çš„æƒé‡ã€‚

æ ¹æ®æ³°å‹’å±•å¼€ï¼Œçª—å£å¹³ç§»åå›¾åƒçš„ä¸€é˜¶è¿‘ä¼¼ä¸ºï¼š

`$$
\begin{aligned}
I(x + u, y + v) &= I(x, y) + I_{x}(x, y) u + I_{y}(x, y) v + O\left(u^2, v^2\right) \\
& \approx I(x, y) + I_{x}(x, y) u + I_{y}(x, y) v
\end{aligned}
$$`

å…¶ä¸­ï¼Œ`$I_{x}$` å’Œ `$I_{y}$` æ˜¯å›¾åƒ `$I(x, y)$` çš„åå¯¼æ•°ï¼Œé‚£ä¹ˆå¼ `$\ref{eq:e_u_v}$` å¯ä»¥ç®€åŒ–ä¸ºï¼š

`$$
\begin{aligned}
E\left(u, v\right) & \approx \sum_{x, y} w(x, y)\left[I_{x}(x, y) u + I_{y}(x, y) v\right]^{2} \\
&=\left[\begin{array}{ll}
u & v
\end{array}\right] M(x, y)\left[\begin{array}{c}
u \\
v
\end{array}\right]
\end{aligned}
$$`

å…¶ä¸­ï¼Œ

`$$
M=\sum w(x, y)\left[\begin{array}{cc}
I_{x}^{2} & I_{x} I_{y} \\
I_{x} I_{y} & I_{y}^{2}
\end{array}\right]
$$`

é€šè¿‡æ±‚è§£ `$M$` çš„ç‰¹å¾å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— `$E(u, v)$` æœ€å¤§å’Œæœ€å°å¢é‡çš„æ–¹å‘ï¼Œå¯¹åº”çš„ç‰¹å¾å€¼åˆ™ä¸ºå®é™…çš„å¢é‡å€¼ã€‚Harris è§’ç‚¹æ£€æµ‹æ–¹æ³•å¯¹æ¯ä¸€ä¸ªçª—å£å®šä¹‰äº†ä¸€ä¸ª `$R$` å€¼ï¼š

`$$
R = \operatorname{det} M - k (\operatorname{trace} M)^{2}
$$`

å…¶ä¸­ï¼Œ`$\operatorname{det} M = \lambda_1 \lambda_2$` æ˜¯çŸ©é˜µ `$M$` çš„è¡Œåˆ—å¼ï¼Œ`$\operatorname{trace} M = \lambda_1 + \lambda_2$` æ˜¯çŸ©é˜µ `$M$` çš„è¿¹ï¼Œ`$\lambda_1$` å’Œ `$\lambda_2$` ä¸ºçŸ©é˜µ `$M$` ç‰¹å¾å€¼ï¼Œ`$k$` ä¸ºç»éªŒå¸¸æ•°ï¼Œé€šå¸¸å–å€¼ä¸º `$[0.04, 0.06]$`ã€‚ç‰¹å¾å€¼å†³å®šäº†å½“å‰åŒºåŸŸæ˜¯ä¸€ä¸ªè§’ã€è¾¹è¿˜æ˜¯å¹³å¦åŒºåŸŸã€‚

1. å½“ `$\lvert R \rvert$` æ¯”è¾ƒå°æ—¶ï¼Œ`$\lambda_1$` å’Œ `$\lambda_2$` å‡æ¯”è¾ƒå°ï¼Œåˆ™åŒºåŸŸä¸ºå¹³å¦åŒºåŸŸã€‚
2. å½“ `$R < 0$` æ—¶ï¼Œ`$\lambda_1 \gg \lambda_2$` æˆ– `$\lambda_1 \ll \lambda_2$`ï¼Œåˆ™åŒºåŸŸä¸ºè¾¹ã€‚
3. å½“ `$R$` è¾ƒå¤§æ—¶ï¼Œ`$\lambda_1$` å’Œ `$\lambda_2$` éƒ½å¾ˆå¤§ä¸” `$\lambda_1 \sim \lambda_2$`ï¼Œåˆ™åŒºåŸŸä¸ºè§’ã€‚

![](/images/cn/2022-01-27-content-based-image-retrieval/harris-corner-detector-eigen-values.png)

Harris è§’ç‚¹æ£€æµ‹æ–¹æ³•å…·å¤‡å¦‚ä¸‹æ€§è´¨ï¼š

1. **`$k$` å½±å“è¢«æ£€æµ‹è§’ç‚¹æ•°é‡**ï¼šå¢å¤§ `$k$` å°†å‡å° `$R$`ï¼Œä»è€Œå‡å°‘è¢«æ£€æµ‹è§’ç‚¹çš„æ•°é‡ï¼Œåä¹‹äº¦ç„¶ã€‚
2. **å¯¹äº®åº¦å’Œå¯¹æ¯”åº¦çš„å˜åŒ–ä¸æ•æ„Ÿ**ï¼šHarris è§’ç‚¹æ£€æµ‹å¯¹å›¾åƒè¿›è¡Œå¾®åˆ†è¿ç®—ï¼Œå¾®åˆ†è¿ç®—å¯¹å›¾åƒå¯†åº¦çš„æ‹‰å‡æˆ–æ”¶ç¼©å’Œå¯¹äº®åº¦çš„æŠ¬é«˜æˆ–ä¸‹é™ä¸æ•æ„Ÿã€‚
3. **å…·æœ‰æ—‹è½¬ä¸å˜æ€§**ï¼šHarris è§’ç‚¹æ£€æµ‹ç®—å­ä½¿ç”¨çš„æ˜¯è§’ç‚¹é™„è¿‘åŒºåŸŸçš„ç°åº¦äºŒé˜¶çŸ©çŸ©é˜µã€‚è€ŒäºŒé˜¶çŸ©çŸ©é˜µå¯ä»¥è¡¨ç¤ºæˆä¸€ä¸ªæ¤­åœ†ï¼Œæ¤­åœ†çš„é•¿çŸ­è½´æ­£æ˜¯äºŒé˜¶çŸ©çŸ©é˜µç‰¹å¾å€¼å¹³æ–¹æ ¹çš„å€’æ•°ã€‚å½“ç‰¹å¾æ¤­åœ†è½¬åŠ¨æ—¶ï¼Œç‰¹å¾å€¼å¹¶ä¸å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥åˆ¤æ–­è§’ç‚¹çš„ `$R$` å€¼ä¹Ÿä¸å‘ç”Ÿå˜åŒ–ã€‚
4. **ä¸å…·æœ‰å°ºåº¦ä¸å˜æ€§**ï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“å·¦å›¾è¢«ç¼©å°æ—¶ï¼Œåœ¨æ£€æµ‹çª—å£å°ºå¯¸ä¸å˜çš„å‰æä¸‹ï¼Œåœ¨çª—å£å†…æ‰€åŒ…å«å›¾åƒçš„å†…å®¹æ˜¯å®Œå…¨ä¸åŒçš„ã€‚å·¦ä¾§çš„å›¾åƒå¯èƒ½è¢«æ£€æµ‹ä¸ºè¾¹ç¼˜æˆ–æ›²çº¿ï¼Œè€Œå³ä¾§çš„å›¾åƒåˆ™å¯èƒ½è¢«æ£€æµ‹ä¸ºä¸€ä¸ªè§’ç‚¹ã€‚

![](/images/cn/2022-01-27-content-based-image-retrieval/harris-corner-detector-scale-variant.png)

åˆ©ç”¨ Harris æ–¹æ³•æ£€æµ‹è§’ç‚¹çš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆä»£ç è¯¦è§[è¿™é‡Œ](https://github.com/leovan/leovan.me/tree/master/scripts/cn/2022-01-27-content-based-image-retrieval/harris-corner-detector.py)ï¼‰ï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/blox-raw-and-harris-corner.png)

#### å°ºåº¦ç©ºé—´æå€¼æ£€æµ‹

ä¸ºäº†ä½¿æ£€æµ‹åˆ°çš„ç‰¹å¾ç‚¹å…·å¤‡å°ºåº¦ä¸å˜æ€§ï¼Œä½¿èƒ½å¤Ÿåœ¨ä¸åŒå°ºåº¦æ£€æµ‹åˆ°å°½å¯èƒ½å®Œæ•´çš„ç‰¹å¾ç‚¹æˆ–å…³é”®ç‚¹ï¼Œåˆ™éœ€è¦å€ŸåŠ©å°ºåº¦ç©ºé—´ç†è®ºæ¥æè¿°å›¾åƒçš„å¤šå°ºåº¦ç‰¹å¾ã€‚ç›¸å…³ç ”ç©¶è¯æ˜é«˜æ–¯å·ç§¯æ ¸æ˜¯å®ç°å°ºåº¦å˜æ¢çš„å”¯ä¸€çº¿æ€§æ ¸ã€‚å› æ­¤å¯ç”¨å›¾åƒçš„é«˜æ–¯é‡‘å­—å¡”è¡¨ç¤ºå°ºåº¦ç©ºé—´ï¼Œè€Œä¸”å°ºåº¦è§„èŒƒåŒ–çš„ LoG ç®—å­å…·æœ‰å°ºåº¦ä¸å˜æ€§ï¼Œåœ¨å…·ä½“å®ç°ä¸­ï¼Œå¯ç”¨é«˜æ–¯å·®åˆ†ï¼ˆ DoGï¼‰ç®—å­è¿‘ä¼¼ LoG ç®—å­ï¼Œåœ¨æ„å»ºçš„å°ºåº¦ç©ºé—´ä¸­æ£€æµ‹ç¨³å®šçš„ç‰¹å¾ç‚¹ã€‚

åœ¨å›¾åƒå¤„ç†æ¨¡å‹ä¸­å¼•å…¥ä¸€ä¸ªè¢«è§†ä¸ºå°ºåº¦çš„å‚æ•°ï¼Œé€šè¿‡è¿ç»­å˜åŒ–å°ºåº¦å‚æ•°è·å–å¤šå°ºåº¦ä¸‹çš„ç©ºé—´è¡¨ç¤ºåºåˆ—ï¼Œå¯¹è¿™äº›ç©ºé—´åºåˆ—æå–æŸäº›ç‰¹å¾æè¿°å­ï¼ŒæŠ½è±¡æˆç‰¹å¾å‘é‡ï¼Œå®ç°å›¾åƒåœ¨ä¸åŒå°ºåº¦æˆ–ä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾æå–ã€‚å°ºåº¦ç©ºé—´ä¸­å„å°ºåº¦å›¾åƒçš„æ¨¡ç³Šç¨‹åº¦é€æ¸å˜å¤§ï¼Œæ¨¡æ‹Ÿäººåœ¨ç”±è¿‘åˆ°è¿œæ—¶ç›®æ ‡åœ¨äººçœ¼è§†ç½‘è†œä¸Šçš„æˆåƒè¿‡ç¨‹ã€‚è€Œä¸”å°ºåº¦ç©ºé—´éœ€æ»¡è¶³ä¸€å®šçš„ä¸å˜æ€§ï¼ŒåŒ…æ‹¬å›¾åƒç°åº¦ä¸å˜æ€§ã€å¯¹æ¯”åº¦ä¸å˜æ€§ã€å¹³ç§»ä¸å˜æ€§ã€å°ºåº¦ä¸å˜æ€§ä»¥åŠæ—‹è½¬ä¸å˜æ€§ç­‰ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ç”šè‡³è¦æ±‚å°ºåº¦ç©ºé—´ç®—å­å…·å¤‡ä»¿å°„ä¸å˜æ€§ã€‚

å›¾åƒçš„å°ºåº¦ç©ºé—´ `$L(x, y, \sigma)$` å¯ä»¥å®šä¹‰ä¸ºå›¾åƒ `$I(x, y)$` ä¸å¯å˜å°ºåº¦çš„é«˜æ–¯å‡½æ•° `$G(x, y, \sigma)$` çš„å·ç§¯ï¼š

`$$
\begin{aligned}
L(x, y, \sigma) &= G(x, y, \sigma) * I(x, y) \\
G(x, y, \sigma) &= \frac{1}{2 \pi \sigma^{2}} e^{-\frac{x^{2}+y^{2}}{2 \sigma^{2}}}
\end{aligned}
$$`

å…¶ä¸­ï¼Œ`$\sigma$` æ˜¯å°ºåº¦å˜åŒ–å› å­ï¼Œå¤§å°å†³å®šå›¾åƒçš„å¹³æ»‘ç¨‹åº¦ï¼Œå€¼è¶Šå¤§å›¾åƒè¶Šæ¨¡ç³Šã€‚å¤§å°ºåº¦å¯¹åº”å›¾åƒçš„æ¦‚è²Œç‰¹å¾ï¼Œå°å°ºåº¦å¯¹åº”å›¾åƒçš„ç»†èŠ‚ç‰¹å¾ã€‚ä¸€èˆ¬æ ¹æ® `$3 \sigma$` åŸåˆ™ï¼Œé«˜æ–¯æ ¸çŸ©é˜µçš„å¤§å°è®¾ä¸º `$(6 \sigma+1) \times(6 \sigma+1)$`ã€‚

å°ºåº¦å½’ä¸€åŒ–çš„é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯å‡½æ•° `$\sigma^{2} \nabla^{2} G$` å¯ä»¥æå–ç¨³å®šçš„ç‰¹å¾ï¼Œé«˜æ–¯å·®åˆ†å‡½æ•°ï¼ˆDifference-of-Gaussianï¼ŒDoGï¼‰
[^lindeberg1994scale] ä¸å°ºåº¦å½’ä¸€åŒ–çš„é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯å‡½æ•°è¿‘ä¼¼ï¼š

`$$
\begin{aligned}
LoG &= \sigma^{2} \nabla^{2} G \\
DoG &= G(x, y, \sigma_2) - G(x, y, \sigma_1)
\end{aligned}
$$`

åˆ©ç”¨å·®åˆ†è¿‘ä¼¼æ›¿ä»£å¾®åˆ†ï¼Œæœ‰ï¼š

`$$
\sigma \nabla^{2} G=\frac{\partial G}{\partial \sigma} \approx \frac{G(x, y, k \sigma)-G(x, y, \sigma)}{k \sigma-\sigma}
$$`

å› æ­¤æœ‰ï¼š

`$$
G(x, y, k \sigma)-G(x, y, \sigma) \approx(k-1) \sigma^{2} \nabla^{2} G
$$`

å…¶ä¸­ï¼Œ`$k - 1$` æ˜¯ä¸ªå¸¸æ•°ï¼Œä¸å½±å“æå€¼ç‚¹çš„æ£€æµ‹ï¼ŒDoG å’Œ LoG çš„å¯¹æ¯”å›¾å¦‚ä¸‹ï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/log-dog.png)

åœ¨ä½¿ç”¨é«˜æ–¯é‡‘å­—å¡”æ„å»ºå°ºåº¦ç©ºé—´æ—¶ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šå¯¹å›¾åƒåšä¸‹é‡‡æ ·ï¼Œä»¥åŠå¯¹å›¾åƒåšä¸åŒå°ºåº¦çš„é«˜æ–¯æ¨¡ç³Šã€‚å¯¹å›¾åƒåšé™é‡‡æ ·å¾—åˆ°ä¸åŒå°ºåº¦çš„å›¾åƒï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„ç»„ï¼ˆOctaveï¼‰ï¼Œåé¢çš„ Octaveï¼ˆé«˜ä¸€å±‚çš„é‡‘å­—å¡”ï¼‰ä¸ºä¸Šä¸€ä¸ª Octaveï¼ˆä½ä¸€å±‚çš„é‡‘å­—å¡”ï¼‰ä¸‹é‡‡æ ·å¾—åˆ°ï¼Œå›¾åƒå®½é«˜åˆ†åˆ«ä¸ºä¸Šä¸€ä¸ª Octave çš„ 1/2 ã€‚æ¯ç»„ï¼ˆOctaveï¼‰åˆåˆ†ä¸ºè‹¥å¹²å±‚ï¼ˆIntervalï¼‰ï¼Œé€šè¿‡å¯¹å›¾åƒåšä¸åŒå°ºåº¦çš„é«˜æ–¯æ¨¡ç³Šå¾—åˆ°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/dog-pyramid.png)

åœ¨ç”±å›¾åƒé‡‘å­—å¡”è¡¨ç¤ºçš„å°ºåº¦ç©ºé—´ä¸­ï¼ŒOctave ç”±åŸå§‹å›¾åƒçš„å¤§å°å’Œå¡”é¡¶å›¾åƒçš„å¤§å°å†³å®šï¼š

`$$
Octave = \log_2 \left(\min\left(w_b, h_b\right)\right) - \log_2 \left(\min\left(w_t, h_t\right)\right)
$$`

å…¶ä¸­ï¼Œ`$w_b$` å’Œ `$h_b$` åˆ†åˆ«ä¸ºåŸå§‹å›¾åƒçš„å®½å’Œé«˜ï¼Œ`$w_t$` å’Œ `$h_t$` åˆ†åˆ«ä¸ºé‡‘å­—å¡”é¡¶éƒ¨å›¾åƒçš„å®½å’Œé«˜ã€‚

å°ºåº¦å‚æ•° `$\sigma$` çš„å–å€¼ä¸é‡‘å­—å¡”çš„ç»„æ•°å’Œå±‚æ•°ç›¸å…³ï¼Œè®¾ç¬¬ä¸€ç»„ç¬¬ä¸€å±‚çš„å°ºåº¦å‚æ•°å–å€¼ä¸º `$\sigma \left(1, 1\right)$`ï¼Œä¸€èˆ¬å–å€¼ä¸º `$1.6$`ï¼Œåˆ™ç¬¬ `$m$` ç»„ç¬¬ `$n$` å±‚çš„å–å€¼ä¸ºï¼š

`$$
\sigma(m, n)=\sigma\left(1, 1\right) \cdot 2^{m-1} \cdot k^{n-1}, \quad k=2^{1/S}
$$`

å…¶ä¸­ï¼Œ`$S$` ä¸ºé‡‘å­—å¡”ä¸­æ¯ç»„çš„æœ‰æ•ˆå±‚æ•°ï¼Œ`$k=2^{1/S}$` æ˜¯å˜åŒ–å°ºåº¦å› å­ã€‚åœ¨æ£€æµ‹æå€¼ç‚¹å‰å¯¹åŸå§‹å›¾åƒçš„é«˜æ–¯å¹³æ»‘ä¼šå¯¼è‡´å›¾åƒé«˜é¢‘ä¿¡æ¯çš„ä¸¢å¤±ï¼Œæ‰€ä»¥åœ¨å»ºç«‹å°ºåº¦ç©ºé—´ä¹‹å‰ï¼Œå…ˆåˆ©ç”¨åŒçº¿æ€§æ’å€¼å°†å›¾åƒæ‰©å¤§ä¸ºåŸæ¥çš„ä¸¤å€ï¼Œä»¥ä¿ç•™åŸå§‹å›¾åƒä¿¡æ¯ï¼Œå¢åŠ ç‰¹å¾ç‚¹æ•°é‡ã€‚

ä¸ºäº†å¯»æ‰¾ DoG å°ºåº¦ç©ºé—´çš„æå€¼ç‚¹ï¼Œæ¯ä¸€ä¸ªé‡‡æ ·ç‚¹è¦å’Œå…¶æ‰€æœ‰é‚»åŸŸåƒç´ ç›¸æ¯”è¾ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸­é—´æ£€æµ‹ç‚¹ä¸å…¶åŒå°ºåº¦çš„ 8 ä¸ªé‚»åŸŸåƒç´ ç‚¹ä»¥åŠä¸Šä¸‹ç›¸é‚»ä¸¤å±‚å¯¹åº”çš„ 9Ã—2 ä¸ªåƒç´ ç‚¹ä¸€å…± 26 ä¸ªç‚¹ä½œæ¯”è¾ƒï¼Œä»¥ç¡®ä¿åœ¨å›¾åƒç©ºé—´å’Œå°ºåº¦ç©ºé—´éƒ½èƒ½æ£€æµ‹åˆ°æå€¼ç‚¹ã€‚ä¸€ä¸ªåƒç´ ç‚¹å¦‚æœåœ¨ DoG å°ºåº¦ç©ºé—´æœ¬å±‚åŠä¸Šä¸‹ä¸¤å±‚çš„ 26 é‚»åŸŸä¸­å–å¾—æœ€å¤§æˆ–æœ€å°å€¼æ—¶ï¼Œå°±å¯ä»¥è®¤ä¸ºè¯¥ç‚¹æ˜¯å›¾åƒåœ¨è¯¥å°ºåº¦ä¸‹çš„ä¸€ä¸ªç‰¹å¾ç‚¹ã€‚

![](/images/cn/2022-01-27-content-based-image-retrieval/dog-extremum.png)

åœ¨æå€¼æ¯”è¾ƒçš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ç»„å·®åˆ†å›¾åƒçš„é¦–æœ«ä¸¤å±‚æ˜¯æ— æ³•æ¯”è¾ƒçš„ï¼Œä¸ºäº†åœ¨æ¯ç»„ä¸­æ£€æµ‹ `$S$` ä¸ªå°ºåº¦çš„æå€¼ç‚¹ï¼Œåˆ™ DoG é‡‘å­—å¡”æ¯ç»„é¡»æœ‰ `$S+2$` å±‚å›¾åƒï¼Œé«˜æ–¯é‡‘å­—å¡”æ¯ç»„é¡»æœ‰ `$S+3$` å±‚å›¾åƒã€‚å¦å¤–ï¼Œåœ¨ä¸‹é‡‡æ ·æ—¶ï¼Œé«˜æ–¯é‡‘å­—å¡”ä¸­åä¸€ç»„ï¼ˆOctiveï¼‰çš„åº•å±‚å›¾åƒæ˜¯ç”±å‰ä¸€ç»„å›¾åƒçš„å€’æ•°ç¬¬ 3 å¼ å›¾åƒï¼ˆ`$S+1$` å±‚ï¼‰éš”ç‚¹é‡‡æ ·å¾—åˆ°ã€‚è¿™æ ·ä¹Ÿä¿è¯äº†å°ºåº¦å˜åŒ–çš„è¿ç»­æ€§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/dog-scale-varation.png)

#### å…³é”®ç‚¹å®šä½

åœ¨ DoG å°ºåº¦ç©ºé—´æ£€æµ‹åˆ°çš„æå€¼ç‚¹æ˜¯ç¦»æ•£çš„ï¼Œé€šè¿‡æ‹Ÿåˆä¸‰å…ƒäºŒæ¬¡å‡½æ•°å¯ä»¥ç²¾ç¡®å®šä½å…³é”®ç‚¹çš„ä½ç½®å’Œå°ºåº¦ï¼Œè¾¾åˆ°äºšåƒç´ ç²¾åº¦ã€‚åŒæ—¶å»é™¤ä½å¯¹æ¯”åº¦çš„æ£€æµ‹ç‚¹å’Œä¸ç¨³å®šçš„è¾¹ç¼˜ç‚¹ï¼ˆå› ä¸º DoG ç®—å­ä¼šäº§ç”Ÿè¾ƒå¼ºçš„è¾¹ç¼˜å“åº”ï¼‰ï¼Œä»¥å¢å¼ºåŒ¹é…ç¨³å®šæ€§ï¼Œæé«˜æŠ—å™ªå£°èƒ½åŠ›ã€‚

ç¦»æ•£ç©ºé—´çš„æå€¼ç‚¹å¹¶ä¸æ˜¯çœŸæ­£çš„æå€¼ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºä¸€ç»´å‡½æ•°ç¦»æ•£ç©ºé—´å¾—åˆ°çš„æå€¼ç‚¹ä¸è¿ç»­ç©ºé—´æå€¼ç‚¹çš„å·®åˆ«ã€‚åˆ©ç”¨å·²çŸ¥çš„ç¦»æ•£ç©ºé—´ç‚¹æ’å€¼å¾—åˆ°çš„è¿ç»­ç©ºé—´æå€¼ç‚¹çš„æ–¹æ³•å«åšå­åƒç´ æ’å€¼ï¼ˆSub-pixel Interpolationï¼‰ã€‚

![](/images/cn/2022-01-27-content-based-image-retrieval/extremum-points.png)

å‡è®¾åœ¨å°ºåº¦ä¸º `$\sigma$` çš„å°ºåº¦å›¾åƒ `$D(x, y, \sigma)$` æ£€æµ‹åˆ°ä¸€ä¸ªå±€éƒ¨æå€¼ç‚¹ï¼Œç©ºé—´ä½ç½®ä¸º `$(x, y, \sigma)$`ã€‚æ ¹æ®ä¸Šå›¾ç›´è§‚å¯çŸ¥ï¼Œå®ƒåªæ˜¯ç¦»æ•£æƒ…å†µä¸‹çš„æå€¼ç‚¹ï¼Œè€Œè¿ç»­æƒ…å†µä¸‹ï¼Œæå€¼ç‚¹å¯èƒ½åè½åœ¨ `$(x, y, \sigma)$` é™„è¿‘ï¼Œè®¾è¿ç»­æƒ…å†µçš„æ­£çœŸæå€¼ç‚¹åç¦» `$(x, y, \sigma)$` çš„åæ ‡ä¸º `$(\Delta x, \Delta y, \Delta \sigma)$`ã€‚åˆ™å¯¹ `$D(x + \Delta x, y + \Delta y, \sigma + \Delta \sigma)$` åœ¨ `$D(x, y, \sigma)$` å¤„è¿›è¡Œæ³°å‹’å±•å¼€ï¼ˆä¿ç•™äºŒé˜¶ï¼‰ï¼Œæœ‰ï¼š

`$$
\begin{split}
& \ D(x+\Delta x, y+\Delta y, \sigma+\Delta \sigma) \\
\approx & \ D(x, y, \sigma)+\left[\begin{array}{lll}
\frac{\partial D}{\partial x} & \frac{\partial D}{\partial y} & \frac{\partial D}{\partial \sigma}
\end{array}\right]\left[\begin{array}{c}
\Delta x \\
\Delta y \\
\Delta \sigma
\end{array}\right] \\
& +\frac{1}{2}\left[\begin{array}{lll}
\Delta x & \Delta y & \Delta \sigma
\end{array}\right]\left[\begin{array}{lll}
\frac{\partial D^{2}}{\partial x^{2}} & \frac{\partial D^{2}}{\partial x \partial y} & \frac{\partial^{2} D}{\partial x \partial \sigma} \\
\frac{\partial D^{2}}{\partial y \partial x} & \frac{\partial D^{2}}{\partial y^{2}} & \frac{\partial D^{2}}{\partial y \partial \sigma} \\
\frac{\partial D^{2}}{\partial \sigma \partial x} & \frac{\partial D^{2}}{\partial \sigma \partial y} & \frac{\partial D^{2}}{\partial \sigma^{2}}
\end{array}\right]\left[\begin{array}{c}
\Delta x \\
\Delta y \\
\Delta \sigma
\end{array}\right]
\end{split}
$$`

å°†ä¸Šå¼å†™æˆçŸ¢é‡å½¢å¼å¦‚ä¸‹ï¼š

`$$
D(X+\Delta X)=D(X)+\frac{\partial D^{\top}(X)}{\partial X} \Delta X+\frac{1}{2} \Delta X^{\top} \frac{\partial^{2} D(X)}{\partial X^{2}} \Delta X
$$`

ä¸Šå¼å¯¹ `$\Delta X$` æ±‚å¯¼ï¼Œå¹¶ä»¤å…¶ç­‰äºé›¶ï¼Œå¯ä»¥å¾—åˆ°æå€¼ç‚¹çš„åç§»é‡ï¼š

`$$
\Delta X=-\frac{\partial^{2} D(X)}{\partial X^{2}}^{-1} \frac{\partial D^{\top}(X)}{\partial X}
$$`

é€šè¿‡å¤šæ¬¡è¿­ä»£ï¼ˆLowe SIFT ç®—æ³•é‡Œæœ€å¤šè¿­ä»£ 5 æ¬¡ï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆå€™é€‰ç‚¹çš„ç²¾ç¡®ä½ç½®ä¸å°ºåº¦ `$\hat{X}$`ã€‚å½“è¶…å‡ºæ‰€è®¾å®šçš„è¿­ä»£æ¬¡æ•°æˆ–è€…è¶…å‡ºå›¾åƒè¾¹ç•Œçš„èŒƒå›´æ—¶åº”åˆ é™¤è¯¥ç‚¹ï¼Œå¦‚æœ `$\lvert D(\hat{X}) \rvert$` å°äºæŸä¸ªé˜ˆå€¼åˆ™å°†è¯¥æå€¼ç‚¹ä¹Ÿåº”è¯¥åˆ é™¤ã€‚

é«˜æ–¯å·®åˆ†å‡½æ•°æœ‰è¾ƒå¼ºçš„è¾¹ç¼˜å“åº”ï¼Œå¯¹äºæ¯”è¾ƒåƒè¾¹ç¼˜çš„ç‚¹åº”è¯¥å»é™¤æ‰ã€‚è¿™æ ·çš„ç‚¹çš„ç‰¹å¾ä¸ºåœ¨æŸä¸ªæ–¹å‘æœ‰è¾ƒå¤§ä¸»æ›²ç‡ï¼Œè€Œåœ¨å‚ç›´çš„æ–¹å‘ä¸»æ›²ç‡å¾ˆå°ã€‚ä¸»æ›²ç‡å¯é€šè¿‡ä¸€ä¸ª `$2 \times 2$` çš„ Hessian çŸ©é˜µæ±‚å‡ºï¼š

`$$
H=\left[\begin{array}{ll}
D_{x x} & D_{x y} \\
D_{x y} & D_{y y}
\end{array}\right]
$$`

`$D$` çš„ä¸»æ›²ç‡å’Œ `$H$` çš„ç‰¹å¾å€¼æˆæ­£æ¯”ï¼Œä»¤ `$\alpha$` ä¸ºè¾ƒå¤§çš„ç‰¹å¾å€¼ï¼Œ`$\beta$` ä¸ºè¾ƒå°çš„ç‰¹å¾å€¼ï¼Œ`$\alpha = \gamma\beta$`ï¼Œåˆ™æœ‰ï¼š

`$$
\begin{aligned}
\operatorname{trace}(H) &= D_{x x}+D_{y y}=\alpha+\beta \\
\operatorname{det}(H) &= D_{x x} D_{y y}-\left(D_{x y}\right)^{2}=\alpha \beta \\
\frac{\operatorname{trace}(H)^{2}}{\operatorname{det}(H)} &= \frac{(\alpha+\beta)^{2}}{\alpha \beta}=\frac{(\gamma+1)^{2}}{\gamma}
\end{aligned}
$$`

ä¸Šå¼çš„ç»“æœåªä¸ä¸¤ä¸ªç‰¹å¾å€¼çš„æ¯”ä¾‹æœ‰å…³ï¼Œè€Œä¸å…·ä½“ç‰¹å¾å€¼æ— å…³ã€‚å½“ä¸¤ä¸ªç‰¹å¾å€¼ç›¸ç­‰æ—¶ï¼Œ`$\dfrac{(\gamma+1)^{2}}{\gamma}$` çš„å€¼æœ€å°ï¼Œéšç€ `$\gamma$` çš„å¢åŠ ï¼Œ`$\dfrac{(\gamma+1)^{2}}{\gamma}$` çš„å€¼ä¹Ÿå¢åŠ ã€‚è®¾å®šä¸€ä¸ªé˜ˆå€¼ `$\gamma_t$`ï¼ˆLowe SIFT ç®—æ³•é‡Œæœ€ `$\gamma_t = 10$`ï¼‰ï¼Œè‹¥ï¼š

`$$
\frac{\operatorname{trace}(H)^{2}}{\operatorname{det}(H)}<\frac{\left(\gamma_{t}+1\right)^{2}}{\gamma_{t}}
$$`

åˆ™è®¤ä¸ºè¯¥å…³é”®ç‚¹ä¸æ˜¯è¾¹ç¼˜ï¼Œå¦åˆ™äºˆä»¥å‰”é™¤ã€‚

#### å…³é”®ç‚¹æ–¹å‘æŒ‡å®š

ä¸ºäº†ä½¿ç‰¹å¾æè¿°ç¬¦å…·æœ‰æ—‹è½¬ä¸å˜æ€§ï¼Œéœ€è¦åˆ©ç”¨å…³é”®ç‚¹é‚»åŸŸåƒç´ çš„æ¢¯åº¦æ–¹å‘åˆ†å¸ƒç‰¹æ€§ä¸ºæ¯ä¸ªå…³é”®ç‚¹æŒ‡å®šæ–¹å‘å‚æ•°ã€‚å¯¹äºåœ¨ DoG é‡‘å­—å¡”ä¸­æ£€æµ‹å‡ºçš„å…³é”®ç‚¹ï¼Œåœ¨å…¶é‚»è¿‘é«˜æ–¯é‡‘å­—å¡”å›¾åƒçš„ 3ğœ é‚»åŸŸçª—å£å†…è®¡ç®—å…¶æ¢¯åº¦å¹…å€¼å’Œæ–¹å‘ï¼Œå…¬å¼å¦‚ä¸‹ï¼š

`$$
\begin{aligned}
&m(x, y)=\sqrt{(L(x+1, y)-L(x-1, y))^{2}+(L(x, y+1)-L(x, y-1))^{2}} \\
&\theta(x, y)=\arctan ((L(x, y+1)-L(x, y-1)) /(L(x+1, y)-L(x-1, y)))
\end{aligned}
$$`

å…¶ä¸­ï¼Œ`$L$` ä¸ºå…³é”®ç‚¹æ‰€åœ¨å°ºåº¦ç©ºé—´çš„ç°åº¦å€¼ï¼Œ`$m(x, y)$` ä¸ºæ¢¯åº¦å¹…å€¼ï¼Œ`$\theta(x, y)$` ä¸ºæ¢¯åº¦æ–¹å‘ã€‚å¯¹äºæ¨¡å€¼ `$m(x, y)$` æŒ‰ç…§ `$\theta = 1.5 \theta_{oct}$` é‚»åŸŸçª—å£ä¸º `$3 \theta$` çš„é«˜æ–¯åˆ†å¸ƒåŠ æƒã€‚åœ¨å®Œæˆå…³é”®ç‚¹çš„æ¢¯åº¦è®¡ç®—åï¼Œä½¿ç”¨ç›´æ–¹å›¾ç»Ÿè®¡é‚»åŸŸå†…åƒç´ çš„æ¢¯åº¦å’Œæ–¹å‘ï¼Œæ¢¯åº¦ç›´æ–¹å›¾å°†æ¢¯åº¦æ–¹å‘ `$\left(0,360^{\circ}\right)$` åˆ†ä¸º 36 ä¸ªæŸ±ï¼ˆbinsï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆä¸ºç®€åŒ–ï¼Œå›¾ä¸­åªç”»äº†å…«ä¸ªæ–¹å‘çš„ç›´æ–¹å›¾ï¼‰ï¼Œç›´æ–¹å›¾çš„å³°å€¼æ‰€åœ¨çš„æ–¹å‘ä»£è¡¨äº†è¯¥å…³é”®ç‚¹çš„ä¸»æ–¹å‘ã€‚

![](/images/cn/2022-01-27-content-based-image-retrieval/orientation-assignment.png)

æ¢¯åº¦æ–¹å‘ç›´æ–¹å›¾çš„å³°å€¼ä»£è¡¨äº†è¯¥ç‰¹å¾ç‚¹å¤„é‚»åŸŸæ¢¯åº¦çš„ä¸»æ–¹å‘ï¼Œä¸ºäº†å¢å¼ºé²æ£’æ€§ï¼Œä¿ç•™å³°å€¼å¤§äºä¸»æ–¹å‘å³°å€¼ 80% çš„æ–¹å‘ä½œä¸ºè¯¥å…³é”®ç‚¹çš„è¾…æ–¹å‘ã€‚å› æ­¤ï¼Œåœ¨ç›¸åŒä½ç½®å’Œå°ºåº¦ï¼Œå°†ä¼šæœ‰å¤šä¸ªå…³é”®ç‚¹è¢«åˆ›å»ºä½†æ–¹å‘ä¸åŒï¼Œè¿™å¯ä»¥æé«˜ç‰¹å¾ç‚¹åŒ¹é…çš„ç¨³å®šæ€§ã€‚

#### å…³é”®ç‚¹ç‰¹å¾æè¿°ç¬¦

åœ¨ç»è¿‡ä¸Šè¿°æµç¨‹åï¼Œæ£€æµ‹åˆ°çš„æ¯ä¸ªå…³é”®ç‚¹æœ‰ä¸‰ä¸ªä¿¡æ¯ï¼šä½ç½®ã€å°ºåº¦ä»¥åŠæ–¹å‘ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸ºæ¯ä¸ªå…³é”®ç‚¹å»ºç«‹ä¸€ä¸ªæè¿°ç¬¦ï¼Œç”¨ä¸€ç»„å‘é‡å°†è¿™ä¸ªå…³é”®ç‚¹æè¿°å‡ºæ¥ã€‚è¿™ä¸ªç‰¹å¾æè¿°ç¬¦ä¸ä½†åŒ…æ‹¬å…³é”®ç‚¹ï¼Œè¿˜åŒ…æ‹¬å…¶é‚»åŸŸåƒç´ çš„è´¡çŒ®ï¼Œè€Œä¸”éœ€å…·å¤‡è¾ƒé«˜çš„ç‹¬ç‰¹æ€§å’Œç¨³å®šæ€§ï¼Œä»¥æé«˜ç‰¹å¾ç‚¹åŒ¹é…çš„å‡†ç¡®ç‡ã€‚SIFT ç‰¹å¾æè¿°ç¬¦æ˜¯å…³é”®ç‚¹é‚»åŸŸæ¢¯åº¦ç»è¿‡é«˜æ–¯åŠ æƒåç»Ÿè®¡ç»“æœçš„ä¸€ç§è¡¨ç¤ºã€‚é€šè¿‡å¯¹å…³é”®ç‚¹å‘¨å›´å›¾åƒåŒºåŸŸåˆ†å—ï¼Œè®¡ç®—å—å†…çš„æ¢¯åº¦ç›´æ–¹å›¾ï¼Œå¾—åˆ°è¡¨ç¤ºå±€éƒ¨ç‰¹å¾ç‚¹ä¿¡æ¯çš„ç‰¹å¾å‘é‡ã€‚ä¾‹å¦‚åœ¨å°ºåº¦ç©ºé—´ `$4 \times 4$` çš„çª—å£å†…ç»Ÿè®¡ 8 ä¸ªæ–¹å‘çš„æ¢¯åº¦ç›´æ–¹å›¾ï¼Œç”Ÿæˆä¸€ä¸ª `$4 \times 4 \times 8 = 128$` ç»´çš„è¡¨ç¤ºå‘é‡ã€‚

ç‰¹å¾æè¿°ç¬¦ä¸ç‰¹å¾ç‚¹æ‰€åœ¨çš„å°ºåº¦æœ‰å…³ï¼Œå› æ­¤ï¼Œå¯¹æ¢¯åº¦çš„æ±‚å–åº”åœ¨ç‰¹å¾ç‚¹å¯¹åº”çš„é«˜æ–¯å›¾åƒä¸Šè¿›è¡Œã€‚å°†å…³é”®ç‚¹é™„è¿‘çš„é‚»åŸŸåˆ’åˆ†ä¸º `$d \times d$` ä¸ªå­åŒºåŸŸ `$(d = 4)$`ï¼Œæ¯ä¸ªå­åŒºåŸŸåšä¸ºä¸€ä¸ªç§å­ç‚¹ï¼Œæ¯ä¸ªç§å­ç‚¹æœ‰ 8 ä¸ªæ–¹å‘ã€‚æ¯ä¸ªå­åŒºåŸŸçš„å¤§å°ä¸å…³é”®ç‚¹æ–¹å‘åˆ†é…æ—¶ç›¸åŒï¼Œå³æ¯ä¸ªåŒºåŸŸè¾¹é•¿ä¸º `$3 \theta_{oct}$`ã€‚è€ƒè™‘åˆ°å®é™…è®¡ç®—æ—¶éœ€è¦è¿›è¡Œä¸‰çº¿æ€§æ’å€¼ï¼Œé‡‡æ ·çª—å£åŒºåŸŸåŠè¾¹é•¿è®¾ä¸º `$\dfrac{3 \theta_{oct} (d + 1)}{2}$`ï¼Œåˆè€ƒè™‘åˆ°æ—‹è½¬å› ç´ ï¼ˆåæ ‡è½´æ—‹è½¬è‡³å…³é”®ç‚¹ä¸»æ–¹å‘ï¼‰ï¼Œè¿™ä¸ªå€¼éœ€è¦ä¹˜ä»¥ `$\sqrt{2}$`ï¼Œæœ€åæ‰€éœ€çš„å›¾åƒåŒºåŸŸåŠå¾„ä¸ºï¼š

`$$
\text{radius} = \dfrac{3 \sigma_{oct} \times \sqrt{2} \times(d+1)}{2}
$$`

![](/images/cn/2022-01-27-content-based-image-retrieval/sampling-area.png)

å°†åæ ‡è½´æ—‹è½¬è‡³å…³é”®ç‚¹ä¸»æ–¹å‘ï¼Œä»¥ç¡®ä¿æ—‹è½¬ä¸å˜æ€§ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/rotate-coordinate.png)

æ—‹è½¬åé‡‡æ ·ç‚¹çš„æ–°åæ ‡ä¸ºï¼š

`$$
\left[\begin{array}{l}
x^{\prime} \\
y^{\prime}
\end{array}\right]=\left[\begin{array}{cc}
\cos \theta & -\sin \theta \\
\sin \theta & \cos \theta
\end{array}\right]\left[\begin{array}{l}
x \\
y
\end{array}\right] \quad(x, y \in[\text {-radius, radius }])
$$`

åœ¨å›¾åƒåŠå¾„åŒºåŸŸå†…å¯¹æ¯ä¸ªåƒç´ ç‚¹æ±‚å…¶æ¢¯åº¦å¹…å€¼å’Œæ–¹å‘ï¼Œå¹¶å¯¹æ¯ä¸ªæ¢¯åº¦å¹…å€¼ä¹˜ä»¥é«˜æ–¯æƒé‡ï¼š

`$$
w=m(u+x, b+v) \times e^{-\frac{x^{\prime 2}+y^{\prime 2}}{2 \sigma_{w}^{2}}}
$$`

å…¶ä¸­ï¼Œ`$u$` å’Œ `$v$` è¡¨ç¤ºå…³é”®ç‚¹åœ¨é«˜æ–¯é‡‘å­—å¡”å›¾ä¸­çš„ä½ç½®åæ ‡ï¼Œ`$x$` å’Œ `$y$` ä¸ºæ—‹è½¬åæ ‡è½´è‡³å…³é”®ç‚¹ä¸»æ–¹å‘**ä¹‹å‰**ç›¸å¯¹å…³é”®ç‚¹çš„åç§»é‡ï¼Œ`$x^{\prime}$` å’Œ `$y^{\prime}$` ä¸ºæ—‹è½¬åæ ‡è½´è‡³å…³é”®ç‚¹ä¸»æ–¹å‘**ä¹‹å**ç›¸å¯¹å…³é”®ç‚¹çš„åç§»é‡ã€‚

å°†æ—‹è½¬åçš„é‡‡æ ·ç‚¹åæ ‡åˆ†é…åˆ°å¯¹åº”çš„å­åŒºåŸŸï¼Œè®¡ç®—å½±å“å­åŒºåŸŸçš„é‡‡æ ·ç‚¹çš„æ¢¯åº¦å’Œæ–¹å‘ï¼Œåˆ†é…åˆ° 8 ä¸ªæ–¹å‘ä¸Šã€‚æ—‹è½¬åçš„é‡‡æ ·ç‚¹ `$(x^{\prime}, y^{\prime})$` è½åœ¨å­åŒºåŸŸçš„ä¸‹æ ‡ä¸ºï¼š

`$$
\left[\begin{array}{l}
x_{d} \\
y_{d}
\end{array}\right]=\frac{1}{3 \sigma_{o c t}}\left[\begin{array}{c}
x^{\prime} \\
y^{\prime}
\end{array}\right]+\frac{d}{2}, \quad x_{d}, y_{d} \in[0, d]
$$`

å°†é‡‡æ ·ç‚¹åœ¨å­åŒºåŸŸçš„ä¸‹æ ‡è¿›è¡Œä¸‰çº¿æ€§æ’å€¼ï¼Œæ ¹æ®ä¸‰ç»´åæ ‡è®¡ç®—ä¸å‘¨å›´å­åŒºåŸŸçš„è·ç¦»ï¼ŒæŒ‰è·ç¦»è¿œè¿‘è®¡ç®—æƒé‡ï¼Œæœ€ç»ˆç´¯åŠ åœ¨ç›¸åº”å­åŒºåŸŸçš„ç›¸å…³æ–¹å‘ä¸Šçš„æƒå€¼ä¸ºï¼š

`$$
w^{\prime} = w \cdot\left[d_{r}^{i} \cdot\left(1-d_{r}\right)^{1-i}\right] \cdot\left[d_{c}^{j} \cdot\left(1-d_{c}^{1-j}\right)\right] \cdot\left[d_{o}^{k} \cdot\left(1-d_{o}\right)^{1-k}\right]
$$`

å…¶ä¸­ï¼Œ`$i, j, k$` å–å€¼ä¸º 0 æˆ– 1ï¼Œ`$d_r, 1- d_r$` æ˜¯å¯¹ç›¸é‚»ä¸¤è¡Œçš„è´¡çŒ®å› å­ï¼Œ`$d_c, 1- d_c$` æ˜¯å¯¹ç›¸é‚»ä¸¤åˆ—çš„è´¡çŒ®å› å­ï¼Œ`$d_o, 1- d_o$` æ˜¯å¯¹ç›¸é‚»ä¸¤ä¸ªæ–¹å‘çš„è´¡çŒ®å› å­ã€‚æ’å€¼è®¡ç®—æ¯ä¸ªç§å­ç‚¹å…«ä¸ªæ–¹å‘çš„æ¢¯åº¦ï¼Œæœ€ç»ˆç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/gradient-hist.png)

å¾—åˆ° 128 ç»´ç‰¹å¾å‘é‡åï¼Œä¸ºäº†å»é™¤å…‰ç…§å˜åŒ–çš„å½±å“ï¼Œéœ€è¦å¯¹å‘é‡è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚éçº¿æ€§å…‰ç…§å˜åŒ–ä»å¯èƒ½å¯¼è‡´æ¢¯åº¦å¹…å€¼çš„è¾ƒå¤§å˜åŒ–ï¼Œä½†å¯¹æ¢¯åº¦æ–¹å‘å½±å“è¾ƒå°ã€‚å› æ­¤å¯¹äºè¶…è¿‡é˜ˆå€¼ 0.2 çš„æ¢¯åº¦å¹…å€¼è®¾ä¸º 0.2 ï¼Œç„¶åå†è¿›è¡Œä¸€æ¬¡å½’ä¸€åŒ–ã€‚æœ€åå°†ç‰¹å¾å‘é‡æŒ‰ç…§å¯¹åº”é«˜æ–¯é‡‘å­—å¡”çš„å°ºåº¦å¤§å°æ’åºã€‚è‡³æ­¤ï¼ŒSIFT ç‰¹å¾æè¿°ç¬¦å½¢æˆã€‚

åˆ©ç”¨ SIFT æ–¹æ³•æ£€æµ‹å…³é”®ç‚¹çš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆä»£ç è¯¦è§[è¿™é‡Œ](https://github.com/leovan/leovan.me/tree/master/scripts/cn/2022-01-27-content-based-image-retrieval/sift-key-points.py)ï¼‰ï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/home-raw-and-sift-key-points.png)

SIFT æ–¹æ³•çš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š

1. **å±€éƒ¨**ï¼šSIFT ç‰¹å¾æ˜¯å›¾åƒçš„å±€éƒ¨ç‰¹å¾ï¼Œå…¶å¯¹æ—‹è½¬ã€å°ºåº¦ç¼©æ”¾ã€äº®åº¦å˜åŒ–ä¿æŒä¸å˜æ€§ï¼Œå¯¹è§†è§’å˜åŒ–ã€ä»¿å°„å˜æ¢ã€å™ªå£°ä¹Ÿä¿æŒä¸€å®šç¨‹åº¦çš„ç¨³å®šæ€§ã€‚
2. **ç‹¬ç‰¹**ï¼šä¿¡æ¯é‡ä¸°å¯Œï¼Œé€‚ç”¨äºåœ¨æµ·é‡ç‰¹å¾æ•°æ®åº“ä¸­è¿›è¡Œå¿«é€Ÿã€å‡†ç¡®çš„åŒ¹é…ã€‚
3. **å¤§é‡**ï¼šå³ä½¿å°‘æ•°çš„å‡ ä¸ªç‰©ä½“ä¹Ÿå¯ä»¥äº§ç”Ÿå¤§é‡çš„ SIFT ç‰¹å¾å‘é‡ã€‚
4. **é«˜æ•ˆ**ï¼šç»ä¼˜åŒ–çš„ SIFT åŒ¹é…ç®—æ³•ç”šè‡³å¯ä»¥è¾¾åˆ°å®æ—¶çš„è¦æ±‚ã€‚
5. **å¯æ‰©å±•**ï¼šå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸å…¶ä»–å½¢å¼çš„ç‰¹å¾å‘é‡è¿›è¡Œè”åˆã€‚

SIFT æ–¹æ³•çš„ç¼ºç‚¹å¦‚ä¸‹ï¼š

1. é»˜è®¤ç®—æ³•çš„å®æ—¶æ€§ä¸é«˜ã€‚
2. éƒ¨åˆ†æƒ…å†µä¸‹ç‰¹å¾ç‚¹è¾ƒå°‘ã€‚
3. å¯¹è¾¹ç¼˜å…‰æ»‘çš„ç›®æ ‡æ— æ³•å‡†ç¡®æå–ç‰¹å¾ç‚¹ã€‚

å¯¹äº SIFT çš„æ”¹è¿›å¯ä»¥å‚è€ƒ SURF [^bay2006surf] å’Œ CSIFT [^abdel2006csift]ã€‚

> æœ¬å°èŠ‚å‚è€ƒï¼š  
> 1. https://docs.opencv.org/5.x/dc/d0d/tutorial_py_features_harris.html  
> 2. https://docs.opencv.org/5.x/da/df5/tutorial_py_sift_intro.html  
> 3. https://lsxiang.github.io/Journey2SLAM/computer_vision/Harris/  
> 4. https://lsxiang.github.io/Journey2SLAM/computer_vision/SIFT/

### ç‰¹å¾ç¼–ç 

#### BoF

BoFï¼ˆBag of Features, Bag of Visual Wordsï¼‰[^sivic2003video] [^radenovic2015multiple] å€Ÿé‰´äº†æ–‡æœ¬ä¸­çš„ BoWï¼ˆBag of Wordsï¼‰æ¨¡å‹çš„æ€è·¯ã€‚ä»å›¾åƒæŠ½è±¡å‡ºå¾ˆå¤šå…·æœ‰ä»£è¡¨æ€§çš„ã€Œå…³é”®è¯ã€ï¼Œå½¢æˆä¸€ä¸ªå­—å…¸ï¼Œå†ç»Ÿè®¡æ¯å¼ å›¾ç‰‡ä¸­å‡ºç°çš„ã€Œå…³é”®è¯ã€é¢‘ç‡ï¼Œå¾—åˆ°å›¾ç‰‡çš„ç‰¹å¾å‘é‡ã€‚BoF ç®—æ³•çš„æµç¨‹å¦‚ä¸‹ï¼š

1. **å±€éƒ¨ç‰¹å¾æå–**ï¼šåˆ©ç”¨ä¸Šæ–‡ä¸­çš„ SIFT ç­‰ç±»ä¼¼æ–¹æ³•æå–å›¾ç‰‡çš„å±€éƒ¨ç‰¹å¾ï¼Œæ¯ä¸ªå›¾ç‰‡æå–çš„ç‰¹å¾æ•°é‡ä¸åŒï¼Œä½†æ¯ä¸ªç‰¹å¾çš„ç»´åº¦æ˜¯ç›¸åŒçš„ï¼ˆä¾‹å¦‚ï¼š128 ç»´ï¼‰ã€‚
2. **æ„å»ºè§†è§‰è¯å…¸**ï¼šåˆ©ç”¨ K-means ç­‰ç®—æ³•å°†æ‰€æœ‰å›¾ç‰‡çš„æ‰€æœ‰ç‰¹å¾å‘é‡è¿›è¡Œèšç±»ï¼Œå¾—åˆ° `$K$` ä¸ªèšç±»ä¸­å¿ƒï¼Œå³ `$K$` ä¸ªè§†è§‰è¯æ±‡ï¼ˆVisual Wordï¼‰ã€‚ç”±äºç‰¹å¾æ•°é‡å¯èƒ½éå¸¸å¤§ï¼Œä½¿ç”¨ K-means ç®—æ³•èšç±»ä¼šç›¸å½“è€—æ—¶ã€‚
3. **ç”Ÿæˆ BoF ç‰¹å¾**ï¼šå¯¹äºä¸€ä¸ªå›¾åƒä¸­çš„æ¯ä¸€ä¸ªç‰¹å¾ï¼Œéƒ½å¯ä»¥åœ¨è§†è§‰è¯å…¸ä¸­æ‰¾åˆ°ä¸€ä¸ªæœ€ç›¸ä¼¼çš„è§†è§‰è¯æ±‡ï¼Œå› æ­¤å¯ä»¥å¯¹è¯¥å›¾åƒç»Ÿè®¡å¾—åˆ°ä¸€ä¸ª `$K$` ç»´çš„ç›´æ–¹å›¾ï¼Œæ¯ä¸ªå€¼è¡¨ç¤ºå›¾åƒä¸­å±€éƒ¨ç‰¹å¾åœ¨è§†è§‰è¯å…¸ä¸­ç›¸ä¼¼è§†è§‰è¯æ±‡çš„é¢‘ç‡ã€‚é’ˆå¯¹è¯¥æ­¥éª¤å¯ä»¥åˆ©ç”¨ TF-IDF çš„æ€æƒ³è·å–åŠ æƒçš„ BoF ç‰¹å¾ç»“æœã€‚

BoF ç®—æ³•çš„ä¸€äº›ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼š

1. åœ¨ä½¿ç”¨ K-means è¿›è¡Œèšç±»æ—¶ï¼Œ`$K$` å’Œåˆå§‹èšç±»ä¸­å¿ƒçš„é€‰å–å¯¹ç»“æœæ•æ„Ÿã€‚å­—å…¸è¿‡å¤§ï¼Œè¯æ±‡ç¼ºä¹ä¸€èˆ¬æ€§ï¼Œå¯¹å™ªå£°æ•æ„Ÿï¼›å­—å…¸è¿‡å°ï¼Œè¯æ±‡åŒºåˆ†æ€§è¾ƒå·®ï¼Œæ— æ³•å……åˆ†è¡¨ç¤ºå›¾ç‰‡ã€‚å¯¹äºæµ·é‡æ•°æ®è®¡ç®—æ‰€éœ€çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦éƒ½æ¯”è¾ƒé«˜ã€‚
2. å°†å›¾åƒè¡¨ç¤ºæˆä¸€ä¸ªæ— åºçš„ç‰¹å¾ï¼Œä¸¢å¤±äº†å›¾ç‰‡ä¸­çš„ç©ºé—´ä¿¡æ¯ï¼Œè¡¨ç¤ºä¸Šå­˜åœ¨ä¸€å®šå±€é™ã€‚

#### VLAD

VLADï¼ˆVector of Local Aggregated Descriptorsï¼‰[^jegou2010aggregating] æ–¹æ³•åŒ BoF ç±»ä¼¼ï¼Œä½†åœ¨ç”Ÿæˆç‰¹å¾æ—¶é‡‡ç”¨å¦‚ä¸‹å…¬å¼ï¼š

`$$
V(j, k)=\sum_{i=1}^{N} \operatorname{sign}_{k}\left(x_{i}\right)\left(x_{i}(j)-c_{k}(j)\right), \quad k \in K, j \in D
$$`

å…¶ä¸­ï¼Œ`$K$` ä¸ºè¯å…¸å¤§å°ï¼Œ`$N$` ä¸ºå›¾ç‰‡çš„å±€éƒ¨ç‰¹å¾æ•°é‡ï¼Œ`$D$` ä¸ºæ¯ä¸ªå±€éƒ¨ç‰¹å¾çš„ç»´åº¦ï¼Œ`$x_i$` è¡¨ç¤ºç¬¬ `$i$` ä¸ªå±€éƒ¨ç‰¹å¾ï¼Œ`$c_k$` è¡¨ç¤ºç¬¬ `$k$` ä¸ªèšç±»ä¸­å¿ƒï¼Œ`$\operatorname{sign}_k$` æ˜¯ä¸€ä¸ªç¬¦å·å‡½æ•°ï¼Œå¦‚æœ `$x_i$` ä¸å±äºèšç±»ä¸­å¿ƒ `$c_k$` åˆ™ä¸º `$0$`ï¼Œåä¹‹åˆ™ä¸º `$1$`ã€‚

ä»ä¸Šå¼ä¸­å¯ä»¥çœ‹å‡º VLAD ç´¯åŠ äº†æ¯ä¸ªèšç±»çš„æ‰€æœ‰ç‰¹å¾æ®‹å·®ï¼Œé€šè¿‡ `$x_i - c_k$` å°†å›¾åƒæœ¬èº«çš„å±€éƒ¨ç‰¹å¾åˆ†å¸ƒå·®å¼‚è½¬æ¢ä¸ºèšç±»ä¸­å¿ƒçš„åˆ†å¸ƒå·®å¼‚ï¼Œé€šè¿‡å½’ä¸€åŒ–å’Œé™ç»´ç­‰æ‰‹æ®µå¾—åˆ°æœ€ç»ˆçš„å…¨å±€ç‰¹å¾ã€‚

#### FV

FVï¼ˆFisher Vectorï¼‰[^perronnin2010improving] æœ¬è´¨ä¸Šæ˜¯ç”¨ä¼¼ç„¶å‡½æ•°çš„æ¢¯åº¦å‘é‡è¡¨ç¤ºä¸€å¹…å›¾åƒã€‚æ¢¯åº¦å‘é‡çš„ç‰©ç†æ„ä¹‰å°±æ˜¯æè¿°èƒ½å¤Ÿä½¿æ¨¡å‹æ›´å¥½åœ°é€‚åº”æ•°æ®çš„å‚æ•°å˜åŒ–æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯æ•°æ®æ‹Ÿåˆä¸­å‚æ•°è°ƒä¼˜çš„è¿‡ç¨‹ã€‚åœ¨ FV ä¸­æˆ‘ä»¬é‡‡ç”¨é«˜æ–¯æ··åˆæ¨¡å‹ï¼ˆGaussian Mixture Modelï¼ŒGMMï¼‰ã€‚

é«˜æ–¯æ··åˆæ¨¡å‹æ˜¯ç”±å¤šä¸ªé«˜æ–¯æ¨¡å‹çº¿æ€§å åŠ è€Œæˆï¼Œå…¬å¼å¦‚ä¸‹ï¼š

`$$
p(x)=\sum_{k=1}^{K} \pi_{k} N\left(x \mid \mu_{k}, \Sigma_{k}\right)
$$`

å…¶ä¸­ï¼Œ`$p(x)$` è¡¨ç¤ºæ•°æ® `$x$` å‡ºç°çš„æ¦‚ç‡ï¼Œ`$K$` è¡¨ç¤ºé«˜æ–¯æ¨¡å‹ä¸ªæ•°ï¼Œ`$\pi_k$` è¡¨ç¤ºç¬¬ `$k$` ä¸ªé«˜æ–¯æ¨¡å‹çš„æƒé‡ï¼Œ`$\mu_k$` è¡¨ç¤ºç¬¬ `$k$` ä¸ªé«˜æ–¯åˆ†å¸ƒçš„å‡å€¼ï¼Œ`$\Sigma_k$` è¡¨ç¤ºç¬¬ `$k$` ä¸ªé«˜æ–¯åˆ†å¸ƒçš„æ–¹å·®ã€‚ç†è®ºä¸Šï¼Œåªè¦ `$K$` è¶³å¤Ÿå¤§ï¼ŒGMM å¯ä»¥é€¼è¿‘ä»»æ„ä¸€ç§æ¦‚ç‡åˆ†å¸ƒã€‚

GMM çš„ç›®æ ‡æ˜¯æ±‚è§£å‚æ•° `$\pi_k, \mu_k, \Sigma_k$` ä½¿å¾—å®ƒç¡®å®šçš„æ¦‚ç‡åˆ†å¸ƒç”Ÿæˆè¿™äº›ç»™å®šæ•°æ®çš„æ¦‚ç‡æœ€å¤§ï¼Œå³ `$\Pi_{i=1}^{N} p\left(x_{i}\right)$` æœ€å¤§ã€‚å‡è®¾å„ä¸ªæ•°æ®ç‚¹ä¹‹é—´æ»¡è¶³ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œå¯ä»¥å°†å…¶è½¬æ¢æˆå¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼š

`$$
\sum_{i=1}^{N} \log \left(p \left(x_i\right)\right)
$$`

å‡è®¾ GMM æ¨¡å‹åŒ…å« `$K$` ä¸ªé«˜æ–¯æ¨¡å‹ï¼Œåˆ™æ¨¡å‹çš„å‚æ•°é›†åˆä¸º `$\lambda = \left\{w_i, \mu_k, \Sigma_k, k = 1, \cdots, K\right\}$`ï¼Œå‡è®¾å…±æœ‰ `$T$` ä¸ªç‰¹å¾å‘é‡ï¼Œåˆ™ä¼¼ç„¶å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š

`$$
\mathcal{L} (x \mid \lambda)=\sum_{t=1}^{T} \log \left(p\left(x_{t} \mid \lambda\right)\right)
$$`

å…¶ä¸­çš„é«˜æ–¯åˆ†å¸ƒæ˜¯å¤šä¸ªåŸºé«˜æ–¯åˆ†å¸ƒçš„æ··åˆï¼š

`$$
\label{eq:fv_gmm}
p\left(x_{t} \mid \lambda\right)=\sum_{k=1}^{K} w_{k} * p_{k}\left(x_{t} \mid \lambda\right)
$$`

æ¯ä¸ªåŸºé«˜æ–¯åˆ†å¸ƒåˆå¯ä»¥è¡¨ç¤ºä¸ºï¼š

`$$
p_{k}\left(x_{t} \mid \lambda\right) = \dfrac{1}{\left(2 \pi\right)^{\frac{D}{2}} \lvert\Sigma_k\rvert^{\frac{1}{2}}} e^{-\frac{1}{2} \left(x - \mu_k\right)^{\prime} \Sigma_k^{-1} \left(x - \mu_k\right)}
$$`

ç”±è´å¶æ–¯å…¬å¼å¯çŸ¥ï¼Œæè¿°ç¬¦ `$x_t$` æ•°æ®ç¬¬ `$i$` ä¸ªé«˜æ–¯æ¨¡å‹çš„æ¦‚ç‡ä¸ºï¼š

`$$
\gamma_{t}(i)=\frac{w_{i} u_{i}\left(x_{t}\right)}{\sum_{k=1}^{K} w_{k} u_{k}\left(x_{t}\right)}
$$`

åˆ™å…¬å¼ `$\ref{eq:fv_gmm}$` çš„æ¢¯åº¦åˆ†é‡ä¸ºï¼š

`$$
\begin{aligned}
\frac{\partial \mathcal{L}(X \mid \lambda)}{\partial w_{i}} &=\sum_{t=1}^{T}\left[\frac{\gamma_{t}(i)}{w_{i}}-\frac{\gamma_{t}(1)}{w_{1}}\right] \text { for } i \geq 2, \\
\frac{\partial \mathcal{L}(X \mid \lambda)}{\partial \mu_{i}^{d}} &=\sum_{t=1}^{T} \gamma_{t}(i)\left[\frac{x_{t}^{d}-\mu_{i}^{d}}{\left(\sigma_{i}^{d}\right)^{2}}\right], \\
\frac{\partial \mathcal{L}(X \mid \lambda)}{\partial \sigma_{i}^{d}} &=\sum_{t=1}^{T} \gamma_{t}(i)\left[\frac{\left(x_{t}^{d}-\mu_{i}^{d}\right)^{2}}{\left(\sigma_{i}^{d}\right)^{3}}-\frac{1}{\sigma_{i}^{d}}\right] .
\end{aligned}
$$`

ç”±äºæ¦‚ç‡ç©ºé—´å’Œæ¬§æ°ç©ºé—´çš„å½’ä¸€åŒ–æ–¹å¼ä¸åŒï¼Œåœ¨æ­¤å¼•å…¥ Fisher Matrix è¿›è¡Œå½’ä¸€åŒ–ï¼š

`$$
\begin{aligned}
f_{w_{i}} &=T\left(\frac{1}{w_{i}}+\frac{1}{w_{1}}\right) \\
f_{\mu_{i}^{d}} &=\frac{T w_{i}}{\left(\sigma_{i}^{d}\right)^{2}}, \\
f_{\sigma_{i}^{d}} &=\frac{2 T w_{i}}{\left(\sigma_{i}^{d}\right)^{2}} .
\end{aligned}
$$`

å½’ä¸€åŒ–åå³ä¸º Fisher å‘é‡ï¼š

`$$
\begin{aligned}
\mathscr{G}_{\alpha_{k}}^{X} &= f_{w_i}^{1/2} \frac{\partial \mathcal{L}(X \mid \lambda)}{\partial w_{i}} =\frac{1}{\sqrt{w_{k}}} \sum_{t=1}^{T}\left(\gamma_{t}(k)-w_{k}\right), \\
\mathscr{G}_{\mu_{k}}^{X} &= f_{\mu_i^d}^{1/2} \frac{\partial \mathcal{L}(X \mid \lambda)}{\partial \mu_{i}^{d}} =\frac{1}{\sqrt{w_{k}}} \sum_{t=1}^{T} \gamma_{t}(k)\left(\frac{x_{t}-\mu_{k}}{\sigma_{k}}\right), \\
\mathscr{G}_{\sigma_{k}}^{X} &= f_{\sigma_i^d}^{1/2} \frac{\partial \mathcal{L}(X \mid \lambda)}{\partial \sigma_{i}^{d}} =\frac{1}{\sqrt{w_{k}}} \sum_{t=1}^{T} \gamma_{t}(k) \frac{1}{\sqrt{2}}\left[\frac{\left(x_{t}-\mu_{k}\right)^{2}}{\sigma_{k}^{2}}-1\right]
\end{aligned}
$$`

å…¶ä¸­ `$\mathscr{G}_{\alpha_{k}}^{X}$` åŒ BoF æœ‰ç±»ä¼¼æ•ˆæœï¼Œ`$\mathscr{G}_{\mu_{k}}^{X}$` åŒ VLAD æœ‰ç±»ä¼¼æ•ˆæœã€‚

### å›¾åƒæ£€ç´¢

#### å€’æ’ç´¢å¼•

å€’æ’ç´¢å¼•æ˜¯ä¸€ç§æé«˜å­˜å‚¨å’Œæ£€ç´¢æ•ˆç‡çš„ç®—æ³•ï¼Œå®ƒå¸¸è¢«ç”¨äºå¤§/ä¸­ç­‰è§„æ¨¡çš„ç¼–ç æœ¬ä¸­ï¼Œç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/image-retrieval-indexing.png)

å€’æ’ç´¢å¼•æ˜¯ä¸€ä¸ªä¸€ç»´ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªæ¡ç›®å¯¹åº”ç¼–ç æœ¬ä¸­çš„ä¸€ä¸ªè§†è§‰è¯æ±‡ã€‚æ¯ä¸€ä¸ªè§†è§‰è¯æ±‡éƒ½åŒ…å«ä¸€ä¸ªå€’æ’è¡¨ï¼Œæ¯ä¸ªå€’æ’è¡¨ä¸­çš„ç´¢å¼•è¢«ç§°ä¸ºç´¢å¼•ç‰¹å¾æˆ–è€…è®°å½•ã€‚å€’æ’ç´¢å¼•å¾ˆå¥½åœ°å‘æŒ¥äº†å¤§è§„æ¨¡ç¼–ç æœ¬è¯æ±‡ç›´æ–¹å›¾ç¨€ç–æ€§çš„ç‰¹ç‚¹ã€‚

#### ANN

åŸºäºè¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ï¼ˆApproximate Nearest Neighbor Searchï¼ŒANNï¼‰çš„æ–¹æ³•ï¼Œè¯·å‚è€ƒä¹‹å‰çš„[åšå®¢](/cn/2020/08/nearest-neighbor-search/)ã€‚

## åŸºäºæ·±åº¦å­¦ä¹ çš„å›¾åƒæ£€ç´¢

åŸºäºæ·±åº¦å­¦çš„å›¾åƒæ£€ç´¢æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/dl-based-cbir-pipeline.png)

1. **ç½‘ç»œå‰é¦ˆæ–¹å¼**ï¼šå°†å›¾ç‰‡è¾“å…¥ DCNN çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šå•è·¯å’Œå¤šè·¯ã€‚å•è·¯å°†æ•´ä¸ªå›¾ç‰‡ä½œä¸ºè¾“å…¥ï¼Œå¤šè·¯ä¾èµ–åŒºåŸŸæå–ï¼Œä¾‹å¦‚ç©ºé—´é‡‘å­—å¡”æ¨¡å‹ï¼ˆSpatial Pyramid Modelsï¼‰å’ŒåŒºåŸŸå€™é€‰ç½‘ç»œï¼ˆRegion Proposal Networksï¼ŒRPNï¼‰ã€‚
2. **æ·±åº¦ç‰¹å¾æå–**ï¼šåŸºäºæ•´ä¸ªå›¾åƒæˆ–éƒ¨åˆ†åŒºå—çš„è¾“å…¥ï¼Œç½‘ç»œçš„æ¿€æ´»å€¼å¯ä»¥ç”¨ä½œåŸå§‹çš„ç‰¹å¾ã€‚å…¨è¿æ¥å±‚æä¾›äº†ä¸€ä¸ªå…¨å±€çš„è§†é‡ï¼Œå°†ä¸€æ•´ä¸ªå›¾ç‰‡è¡¨ç¤ºä¸ºå•ä¸ªå‘é‡ã€‚
3. **ç‰¹å¾åµŒå…¥å’Œé›†æˆ**ï¼šåŸºäºå›¾ç‰‡çº§åˆ«æˆ–åŒºå—çº§åˆ«çš„æè¿°ç¬¦ï¼Œæ„é€ å…¨å±€æˆ–å±€éƒ¨ç‰¹å¾æ—¶åŒ…å«ä¸¤ä¸ªé‡è¦æ­¥éª¤ï¼Œé€šå¸¸ä¸º PCA å’Œç™½åŒ–ã€‚ç‰¹å¾åµŒå…¥å°†ç‹¬ç«‹çš„å±€éƒ¨ç‰¹å¾æ˜ å°„åˆ°ä¸€ä¸ªé«˜ç»´å‘é‡ï¼Œç‰¹å¾é›†æˆåˆ™å°†å¤šä¸ªæ˜ å°„çš„å‘é‡åˆå¹¶æˆä¸€ä¸ªå•ä¸€å‘é‡ã€‚
4. **ç‰¹å¾åŒ¹é…**ï¼šç‰¹å¾åŒ¹é…ç”¨æ¥è¡¡é‡å›¾ç‰‡ä¹‹é—´ç‰¹å¾çš„ç›¸ä¼¼åº¦ã€‚å…¨å±€åŒ¹é…å¯ä»¥é€šè¿‡æ¬§å¼ã€æ±‰æ˜æˆ–å…¶ä»–è·ç¦»åº¦é‡è¿›è¡Œé«˜æ•ˆè®¡ç®—ã€‚å¯¹äºå±€éƒ¨ç‰¹å¾ï¼Œå¯ä»¥é€šè¿‡ RANSAC [^fischler1981random] å’Œè¿‘æœŸçš„ä¸€äº›æ”¹è¿›æ–¹æ³•å¯¹å±€éƒ¨ç‰¹å¾è¿›è¡Œç›¸ä¼¼åº¦æ±‡æ€»æ¥è¯„ä¼°ç›¸ä¼¼æ€§ã€‚

å…³äºå·ç§¯ç¥ç»ç½‘ç»œçš„ç»†èŠ‚ä»‹ç»ï¼Œè¯·å‚è€ƒä¹‹å‰çš„[åšå®¢](/cn/2018/08/cnn/)ã€‚

### ç½‘ç»œå‰é¦ˆæ–¹å¼

#### å•è·¯å‰é¦ˆæ–¹æ³•

å•è·¯å‰é¦ˆæ–¹æ³•æ˜¯å°†æ•´ä¸ªå›¾ç‰‡ç›´æ¥è¾“å…¥æ¨¡å‹æ¥æå–ç‰¹å¾ã€‚ç”±äºä»…å°†å›¾ç‰‡è¾“å…¥æ¨¡å‹ä¸€æ¬¡ï¼Œè¯¥æ–¹æ³•æ•ˆç‡è¾ƒé«˜ã€‚å¯¹äºè¿™ç±»æ–¹æ³•ï¼Œå…¨è¿æ¥å±‚å’Œæœ€åä¸€ä¸ªå·ç§¯å±‚å¯ä»¥ä½œä¸ºç‰¹å¾æå–å™¨ã€‚

#### å¤šè·¯å‰é¦ˆæ–¹æ³•

ç›¸æ¯”äºå•è·¯å‰é¦ˆæ–¹æ³•ï¼Œå¤šè·¯å‰é¦ˆæ–¹æ³•ç”±äºéœ€è¦å°†ç”Ÿæˆçš„å¤šä¸ªå›¾åƒå—è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œå› æ­¤ç›¸å¯¹è€—æ—¶ã€‚è¿™ç±»æ–¹æ³•é€šå¸¸åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šå›¾åƒå—è¯†åˆ«å’Œå›¾åƒå—æè¿°ã€‚ä½¿ç”¨ä¸åŒæ–¹æ³•å¯ä»¥è·å¾—ä¸åŒå°ºåº¦çš„å›¾åƒå—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/image-patch-generation-schemes.png)

å…¶ä¸­ï¼Œ(a) ä¸ºå›ºå®šçª—å£å¤§å°åˆ’åˆ†çš„åŒºå—ï¼Œ(b) ä¸ºç©ºé—´é‡‘å­—å¡”æ¨¡å‹ï¼ˆSpatial Pyramid Modelï¼ŒSPMï¼‰åˆ’åˆ†çš„åŒºå—ï¼Œ\(c\) ä¸ºç¨ å¯†é‡‡æ ·çš„åŒºå—ï¼Œ(d) ä¸ºé€šè¿‡åŒºåŸŸå€™é€‰ç½‘ç»œï¼ˆRegion Proposal Networkï¼ŒRPNï¼‰è·å¾—çš„å€™é€‰åŒºå—ã€‚

### æ·±åº¦ç‰¹å¾é€‰æ‹©

ç‰¹å¾é€‰æ‹©å†³å®šäº†æå–ç‰¹å¾çš„è¡¨è¾¾èŒƒå›´ï¼Œä¾‹å¦‚ï¼šä»å…¨è¿æ¥å±‚å¯ä»¥è·å¾—**å…¨å±€çº§åˆ«ç‰¹å¾**ï¼Œä»å·ç§¯å±‚å¯ä»¥è·å¾—**åŒºå—çº§åˆ«ç‰¹å¾**ã€‚

#### ä»å…¨è¿æ¥å±‚æå–

å°†å…¨è¿æ¥å±‚ä½œä¸ºå…¨å±€ç‰¹å¾æå–å™¨ï¼Œé€šè¿‡ PCA é™ç»´å’Œæ ‡å‡†åŒ–åå¯ä»¥ç”¨äºåº¦é‡å›¾åƒçš„ç›¸ä¼¼æ€§ã€‚ä½†ç”±äºè¿™ä¸€å±‚æ˜¯å…¨è¿æ¥çš„ï¼Œæ¯ä¸ªç¥ç»å…ƒéƒ½ä¼šäº§ç”Ÿå›¾åƒçº§åˆ«çš„æè¿°ç¬¦ï¼Œè¿™ä¼šå¯¼è‡´ä¸¤ä¸ªæ˜æ˜¾çš„ç¼ºé™·ï¼šåŒ…æ‹¬æ— å…³ä¿¡æ¯å’Œç¼ºå°‘å±€éƒ¨å‡ ä½•ä¸å˜æ€§ã€‚

é’ˆå¯¹ç¬¬ä¸€ä¸ªç¼ºé™·ï¼Œå¯ä»¥é€šè¿‡å¤šè·¯å‰é¦ˆæ–¹æ³•æ¥æå–åŒºå—çº§åˆ«ç‰¹å¾ã€‚é’ˆå¯¹ç¬¬äºŒä¸ªç¼ºé™·ï¼Œç¼ºä¹å‡ ä½•ä¸å˜æ€§ä¼šå½±å“å›¾åƒå˜æ¢ï¼ˆå¦‚ï¼šè£å‰ªã€é®æŒ¡ï¼‰æ—¶çš„é²æ£’æ€§ï¼Œé€šè¿‡ä½¿ç”¨ä¸­é—´å·ç§¯å±‚å¯ä»¥æ¥è§£å†³ã€‚

#### ä»å·ç§¯å±‚æå–

ä»å·ç§¯å±‚ï¼ˆé€šå¸¸æ˜¯æœ€åä¸€å±‚ï¼‰æå–çš„ç‰¹å¾ä¿ç•™äº†æ›´å¤šçš„ç»“æ„ç»†èŠ‚ï¼Œè¿™å¯¹å®ä¾‹æ£€ç´¢å°¤ä¸ºæœ‰åˆ©ã€‚å·ç§¯å±‚çš„ç¥ç»å…ƒä»…åŒå±€éƒ¨åŒºåŸŸç›¸è¿æ¥ï¼Œè¿™æ ·è¾ƒå°çš„è§†é‡ç¡®ä¿æ‰€ç”Ÿæˆçš„ç‰¹å¾åŒ…å«æ›´å¤šå±€éƒ¨ç»“æ„ä¿¡æ¯ï¼ŒåŒæ—¶å¯¹äºå›¾åƒå˜æ¢æ›´ä¸ºé²æ£’ã€‚

åŠ å’Œ/å¹³å‡å’Œæœ€å¤§æ± åŒ–æ˜¯ç”¨äºç”Ÿæˆå…¨å±€ç‰¹å¾çš„ä¸¤ä¸ªç®€å•çš„é›†æˆæ–¹æ³•ï¼Œä¸€äº›å…¶ä»–çš„é›†æˆæ–¹æ³•ï¼Œä¾‹å¦‚ï¼šMAC [^razavian2016visual]ï¼ŒR-MAC [^tolias2015particular]ï¼ŒGeM polling [^radenovic2018fine]ï¼ŒSPoC [^babenko2015aggregating]ï¼ŒCroW [^kalantidis2016cross] å’Œ CAM+CroW [^jimenez2017class] å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/representative-methods-in-single-pass-methods.png)

### ç‰¹å¾èåˆç­–ç•¥

#### å±‚çº§åˆ«èåˆ

é€šè¿‡å±‚çº§åˆ«èåˆï¼Œå¯ä»¥åœ¨æ·±åº¦ç½‘ç»œä¸­èåˆå¤šä¸ªå…¨è¿æ¥å±‚ã€‚å…¨è¿æ¥å±‚çš„ç‰¹å¾ä¿ç•™äº†å…¨å±€é«˜å±‚çº§è¯­ä¹‰ä¿¡æ¯ï¼Œå·ç§¯å±‚çš„ç‰¹å¾ä¿ç•™äº†å±€éƒ¨ä¸­ä½å±‚çº§çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå…¨å±€ç‰¹å¾å’Œå±€éƒ¨ç‰¹å¾åœ¨æµ‹é‡è¯­ä¹‰ç›¸ä¼¼åº¦æ—¶ç›¸è¾…ç›¸æˆï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯æ£€ç´¢çš„æ•ˆæœã€‚

#### æ¨¡å‹çº§åˆ«èåˆ

èåˆä¸åŒæ¨¡å‹çš„ç‰¹å¾ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œè¿™ç§èåˆæ–¹å¼å…³æ³¨äºæ¨¡å‹ä¹‹é—´çš„äº’è¡¥æ€§è´¨ï¼Œå…¶å¯ä»¥åˆ†ä¸ºï¼šintra-model å’Œ inter-model ä¸¤ç±»ã€‚intra-model èåˆæ–¹å¼å»ºè®®ä½¿ç”¨å¤šä¸ªå…·æœ‰ç›¸ä¼¼æ€§æˆ–è€…ç»“æ„ä¸Šé«˜åº¦å…¼å®¹çš„æ¨¡å‹ï¼Œè€Œ inter-model èåˆæ–¹å¼åˆ™ä½¿ç”¨ç»“æ„ä¸Šå…·æœ‰å¾ˆå¤§ä¸åŒçš„æ¨¡å‹ã€‚

inter-model å’Œ intra-model èåˆåŒæ¨¡å‹é€‰æ‹©æœ‰å…³ã€‚èåˆå€™é€‰æ¨¡å‹çš„æ‰€æœ‰ç‰¹å¾ï¼Œç„¶åæ ¹æ®æ‹¼æ¥çš„ç‰¹å¾å­¦ä¹ å¾—åˆ°ä¸€ä¸ªåº¦é‡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º early fusion ç­–ç•¥ã€‚æˆ–è€…å¯¹æ¯ä¸ªæ¨¡å‹çš„ç‰¹å¾å­¦ä¹ å„è‡ªçš„æœ€ä¼˜åº¦é‡ï¼Œç„¶åç»„åˆè¿™äº›åº¦é‡ç”¨äºæœ€ç»ˆçš„æ£€ç´¢æ’åï¼Œè¿™ç§æ–¹å¼ç§°ä¸º late fusion ç­–ç•¥ã€‚

### ç‰¹å¾åµŒå…¥å’Œé›†æˆ

ç‰¹å¾åµŒå…¥å’Œé›†æˆçš„ä¸»è¦ç›®çš„æ˜¯è¿›ä¸€æ­¥æé«˜ä» DCNN ä¸­æå–çš„ç‰¹å¾çš„åŒºåˆ†èƒ½åŠ›ï¼Œæ¥ç”Ÿæˆç”¨äºæ£€ç´¢ç‰¹å®šå®ä¾‹çš„æœ€ç»ˆå…¨å±€æˆ–å±€éƒ¨ç‰¹å¾ã€‚

#### åŒ¹é…å…¨å±€ç‰¹å¾

å…¨å±€ç‰¹å¾å¯ä»¥ä»å…¨è¿æ¥å±‚ä¸­æå–ï¼Œç„¶åè¿›è¡Œé™ç»´å’Œæ ‡å‡†åŒ–ï¼Œé€šå¸¸æƒ…å†µä¸‹æ²¡æœ‰è¿›ä¸€æ­¥çš„èšåˆè¿‡ç¨‹ã€‚å·ç§¯ç‰¹å¾ä¹Ÿå¯ä»¥è¢«é›†æˆåˆ°å…¨å±€ç‰¹å¾ä¸­ï¼Œç®€å•çš„æ–¹å¼æ˜¯é€šè¿‡åŠ å’Œ/å¹³å‡æˆ–æœ€å¤§æ± åŒ–ã€‚å·ç§¯ç‰¹å¾å¯ä»¥ä½œä¸ºå±€éƒ¨åŒºåŸŸçš„æè¿°ç¬¦ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨åŸºäº SIFT çš„å›¾åƒæ£€ç´¢ä¸­æåˆ°çš„ BoFï¼ŒVLADï¼ŒFV ç­‰æ¨¡å‹å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œç„¶åå†å°†ä»–ä»¬èšåˆä¸ºä¸€ä¸ªå…¨å±€æè¿°ç¬¦ã€‚

#### åŒ¹é…å±€éƒ¨ç‰¹å¾

å°½ç®¡å…¨å±€ç‰¹å¾åŒ¹é…å¯¹äºç‰¹å¾æå–å’Œç›¸ä¼¼åº¦è®¡ç®—éƒ½å…·æœ‰å¾ˆé«˜çš„æ•ˆç‡ï¼Œä½†å…¨å±€ç‰¹å¾ä¸ç©ºé—´éªŒè¯å’Œå¯¹åº”ä¼°è®¡ä¸å…¼å®¹ï¼Œè¿™äº›æ˜¯å®ä¾‹çº§åˆ«æ£€ç´¢ä»»åŠ¡çš„é‡è¦è¿‡ç¨‹ã€‚åœ¨åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œå…¨å±€ç‰¹å¾åªåŒ¹é…ä¸€æ¬¡ï¼Œè€Œå±€éƒ¨ç‰¹å¾åŒ¹é…é€šè¿‡æ±‡æ€»æ‰€æœ‰å•ä¸ªå±€éƒ¨ç‰¹å¾çš„ç›¸ä¼¼æ€§æ¥è¯„ä¼°ï¼ˆå³å¤šå¯¹å¤šåŒ¹é…ï¼‰ã€‚

#### æ³¨æ„åŠ›æœºåˆ¶

æ³¨æ„åŠ›æœºåˆ¶å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹å¾èšåˆï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯çªå‡ºæœ€ç›¸å…³çš„ç‰¹å¾éƒ¨åˆ†ï¼Œé€šè¿‡è®¡ç®—æ³¨æ„åŠ›æ˜ å°„æ¥å®ç°ã€‚è·å–æ³¨æ„åŠ›æ˜ å°„çš„æ–¹æ³•å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šéå‚æ•°å’Œå‚æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸»è¦åŒºåˆ«åœ¨äºæ³¨æ„åŠ›æ˜ å°„ä¸­çš„é‡è¦æ€§æƒé‡æ˜¯å¦å¯å­¦ä¹ ã€‚

![](/images/cn/2022-01-27-content-based-image-retrieval/attention-mechanisms.png)

éå‚æ•°åŠ æƒæ˜¯ä¸€ç§çªå‡ºç‰¹å¾é‡è¦æ€§çš„ç›´æ¥æ–¹æ³•ï¼Œç›¸åº”çš„æ³¨æ„åŠ›æ˜ å°„å¯ä»¥é€šè¿‡é€šé“æˆ–ç©ºé—´æ± åŒ–è·å¾—ï¼Œå¦‚ (a) å’Œ (b) æ‰€ç¤ºã€‚å‚æ•°æ³¨æ„åŠ›æ˜ å°„å¯ä»¥é€šè¿‡æ·±åº¦ç½‘ç»œå­¦ä¹ ï¼Œå…¶è¾“å…¥å¯ä»¥æ˜¯å›¾åƒå—æˆ–ç‰¹å¾æ˜ å°„ï¼Œè¿™äº›æ–¹æ³•é€šå¸¸ç”¨äºæœ‰ç›‘ç£çš„åº¦é‡å­¦ä¹ ï¼Œå¦‚ \(c\) å’Œ (d) æ‰€ç¤ºã€‚

#### å“ˆå¸ŒåµŒå…¥

æ·±åº¦ç½‘ç»œæå–çš„å®å€¼ç‰¹å¾é€šå¸¸æ˜¯é«˜ç»´çš„ï¼Œä¸å¤ªé€‚åˆæ£€ç´¢ã€‚å› æ­¤ï¼Œå°†æ·±å±‚ç‰¹å¾è½¬æ¢ä¸ºæ›´ç´§å‡‘çš„ç¼–ç å…·æœ‰é‡è¦æ„ä¹‰ã€‚ç”±äºå…¶è®¡ç®—å’Œå­˜å‚¨æ•ˆç‡ï¼Œå“ˆå¸Œç®—æ³•å·²è¢«å¹¿æ³›ç”¨äºå…¨å±€å’Œå±€éƒ¨æè¿°ç¬¦ã€‚

å“ˆå¸Œå‡½æ•°å¯ä»¥ä½œä¸ºä¸€ä¸ªå±‚æ’å…¥åˆ°æ·±åº¦ç½‘ç»œä¸­ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡æœ‰ç›‘ç£æˆ–æ— ç›‘ç£çš„æ–¹å¼åŒæ—¶è®­ç»ƒå’Œä¼˜åŒ–å“ˆå¸Œç å’Œæ·±åº¦ç½‘ç»œã€‚å“ˆå¸Œå‡½æ•°è®­ç»ƒæ—¶ï¼Œç›¸ä¼¼å›¾åƒçš„å“ˆå¸Œç åµŒå…¥ä¼šå°½å¯èƒ½çš„æ¥è¿‘ï¼Œä¸ç›¸ä¼¼å›¾åƒçš„å“ˆå¸Œç åµŒå…¥ä¼šå°½å¯èƒ½çš„åˆ†ç¦»ã€‚

### æ¨¡å‹å¾®è°ƒ

å¾®è°ƒæ–¹æ³•å·²è¢«å¹¿æ³›ç ”ç©¶ä»¥å­¦ä¹ æ›´å¥½çš„æ£€ç´¢ç‰¹å¾ã€‚åœ¨åŸºäºå›¾åƒåˆ†ç±»çš„æ•°æ®é›†ä¸Šé¢„è®­ç»ƒçš„ DCNN å¯¹ç±»é—´å¯å˜æ€§éå¸¸ç¨³å¥ï¼Œéšåå°†æˆå¯¹çš„ç›‘ç£ä¿¡æ¯å¼•å…¥æ’åæŸå¤±ä¸­ï¼Œé€šè¿‡å¯¹æ£€ç´¢è¡¨ç¤ºè¿›è¡Œæ­£åˆ™åŒ–æ¥å¾®è°ƒç½‘ç»œã€‚å…·æœ‰æ¸…æ™°ä¸”å®šä¹‰è‰¯å¥½çš„çœŸå®æ ‡ç­¾çš„æ ‡å‡†æ•°æ®é›†å¯¹äºå¾®è°ƒæ·±åº¦æ¨¡å‹ä»¥æ‰§è¡Œå‡†ç¡®çš„å®ä¾‹çº§æ£€ç´¢æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¦åˆ™å°±éœ€è¦å¼€å‘æ— ç›‘ç£çš„å¾®è°ƒæ–¹æ³•ã€‚åœ¨ç½‘ç»œå¾®è°ƒä¹‹åï¼Œå¯ä»¥å°†ç‰¹å¾ä½œä¸ºå…¨å±€æˆ–å±€éƒ¨æ¥è¿›è¡Œæ£€ç´¢ã€‚

#### æœ‰ç›‘ç£å¾®è°ƒ

ä¸‹å›¾å±•ç¤ºäº†ä¸åŒç±»å‹çš„æœ‰ç›‘ç£å¾®è°ƒæ–¹æ³•ï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/schemes-of-supervised-fine-tuning.png)

ä¸‹å›¾å±•ç¤ºäº†ä¸åŒç±»å‹çš„æœ‰ç›‘ç£å¾®è°ƒæŸå¤±å‡½æ•°ï¼š

![](/images/cn/2022-01-27-content-based-image-retrieval/different-losses-for-network-fine-tuning.png)

#### æ— ç›‘ç£å¾®è°ƒ

ç”±äºæˆæœ¬ç­‰é—®é¢˜å¯èƒ½å¯¼è‡´ç›‘ç£ä¿¡æ¯ä¸è¶³ï¼Œä»è€Œç›‘ç£ç½‘ç»œå¾®è°ƒå˜å¾—ä¸å¯è¡Œã€‚å› æ­¤ï¼Œç”¨äºå›¾åƒæ£€ç´¢çš„æ— ç›‘ç£å¾®è°ƒæ–¹æ³•æ˜¯éå¸¸å¿…è¦çš„ã€‚å¯¹äºæ— ç›‘ç£å¾®è°ƒï¼Œä¸¤ä¸ªæ–¹å‘æ˜¯é€šè¿‡æµå½¢å­¦ä¹ å’Œèšç±»æŠ€æœ¯æŒ–æ˜ç‰¹å¾ä¹‹é—´çš„ç›¸å…³æ€§ã€‚å…·ä½“ç»†èŠ‚ä¸å†å±•å¼€è®¨è®ºï¼Œè¯¦ç»†å†…å®¹è¯·å‚è§åŸæ–‡ã€‚

## å¼€æ”¾èµ„æº

- [Stanford Online Products Retrieval Leaderboard](https://kobiso.github.io/Computer-Vision-Leaderboard/sop)
- [CARS196 Retrieval Leaderboard](https://kobiso.github.io/Computer-Vision-Leaderboard/cars)
- [CUB-200-2011 Retrieval Leaderboard](https://kobiso.github.io/Computer-Vision-Leaderboard/cub)
- [In-shop Clothes Retrieval Leaderboard](https://kobiso.github.io/Computer-Vision-Leaderboard/in-shop)
- [Image Retrieval - Paper with code](https://paperswithcode.com/task/image-retrieval)

[^zheng2017sift]: Zheng, L., Yang, Y., & Tian, Q. (2017). SIFT meets CNN: A decade survey of instance retrieval. _IEEE transactions on pattern analysis and machine intelligence, 40_(5), 1224-1244.

[^chen2022deep]: Chen W., Liu Y., Wang W., Bakker E., Georigiou T., Fieguth P., Liu L., & Lew M. (2022). Deep Learning for Instance Retrieval: A Survey. _arXiv:2101.11282_

[^cbir-wikipedia]: https://zh.wikipedia.org/wiki/åŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢

[^lindeberg1994scale]: Lindeberg, T. (1994). Scale-space theory: A basic tool for analyzing structures at different scales. _Journal of applied statistics, 21_(1-2), 225-270.

[^bay2006surf]: Bay, H., Tuytelaars, T., & Van Gool, L. (2006, May). Surf: Speeded up robust features. _In European conference on computer vision_ (pp. 404-417). Springer, Berlin, Heidelberg.

[^abdel2006csift]: Abdel-Hakim, A. E., & Farag, A. A. (2006, June). CSIFT: A SIFT descriptor with color invariant characteristics. _In 2006 IEEE computer society conference on computer vision and pattern recognition (CVPR'06)_ (Vol. 2, pp. 1978-1983). Ieee.

[^sivic2003video]: Sivic, J., & Zisserman, A. (2003, October). Video Google: A text retrieval approach to object matching in videos. _In Computer Vision, IEEE International Conference on_ (Vol. 3, pp. 1470-1470). IEEE Computer Society.

[^jegou2010aggregating]: JÃ©gou, H., Douze, M., Schmid, C., & PÃ©rez, P. (2010, June). Aggregating local descriptors into a compact image representation. _In 2010 IEEE computer society conference on computer vision and pattern recognition_ (pp. 3304-3311). IEEE.

[^perronnin2010improving]: Perronnin, F., SÃ¡nchez, J., & Mensink, T. (2010, September). Improving the fisher kernel for large-scale image classification. _In European conference on computer vision_ (pp. 143-156). Springer, Berlin, Heidelberg.

[^radenovic2015multiple]: RadenoviÄ‡, F., JÃ©gou, H., & Chum, O. (2015, June). Multiple measurements and joint dimensionality reduction for large scale image search with short vectors. _In Proceedings of the 5th ACM on International Conference on Multimedia Retrieval_ (pp. 587-590).

[^fischler1981random]: Fischler, M. A., & Bolles, R. C. (1981). Random sample consensus: a paradigm for model fitting with applications to image analysis and automated cartography. _Communications of the ACM, 24_(6), 381-395.

[^razavian2016visual]: Razavian, A. S., Sullivan, J., Carlsson, S., & Maki, A. (2016). Visual instance retrieval with deep convolutional networks. _ITE Transactions on Media Technology and Applications, 4_(3), 251-258.

[^tolias2015particular]: Tolias, G., Sicre, R., & JÃ©gou, H. (2015). Particular object retrieval with integral max-pooling of CNN activations. _arXiv preprint arXiv:1511.05879_.

[^radenovic2018fine]: RadenoviÄ‡, F., Tolias, G., & Chum, O. (2018). Fine-tuning CNN image retrieval with no human annotation. _IEEE transactions on pattern analysis and machine intelligence, 41_(7), 1655-1668.

[^babenko2015aggregating]: Babenko, A., & Lempitsky, V. (2015). Aggregating local deep features for image retrieval. _In Proceedings of the IEEE international conference on computer vision_ (pp. 1269-1277).

[^kalantidis2016cross]: Kalantidis, Y., Mellina, C., & Osindero, S. (2016, October). Cross-dimensional weighting for aggregated deep convolutional features. _In European conference on computer vision_ (pp. 685-701). Springer, Cham.

[^jimenez2017class]: Jimenez, A., Alvarez, J. M., & Giro-i-Nieto, X. (2017). Class-weighted convolutional features for visual instance search. _arXiv preprint arXiv:1707.02581_.